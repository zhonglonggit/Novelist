(function(){var a,c,d,b=[].indexOf||function(g){for(var f=0,e=this.length;f<e;f++){if(f in this&&this[f]===g){return f}}return -1};window.console={log:function(){}};a=(function(){e.prototype.ignoreList=[];function e(f){var h,g;if(f==null){f={}}this.config={uid:"0",container:$(".fn-shopping-ads"),title:"",provider:void 0,frame:void 0,id:void 0,request_id:void 0};$.extend(true,this.config,f);if(this.config.uid!=="0"&&(g=this.config.uid,b.call(this.ignoreList,g)>=0)){return}this.ignoreList.push(this.config.uid);this.config.id=f.id;this.config._$=$("<ul class='ads_tab'> <li><a href='javascript:;' class='current'>"+this.config.title+"</a></li> </ul> <div class='ads_box'> <div class='show_list'> <div class='fn-arrows' style='display:none'> <a href='#' class='arrow left'></a> <a href='#' class='arrow right'></a> </div> <div class='fn-ad-items'> <div class='none_box'> <img src='images/monkey.gif'> </div> </div> </div> </div>");if(this.config.content){this.config._$.find(".show_list").html(this.config.content)}$("#"+this.config.id).html(this.config._$);$("#"+this.config.id).show();if(typeof(h=this.config).provider==="function"){h.provider(this)}}e.prototype.render=function(g){var E,h,o,p,u,z,C,A,y,D,w,B,x,v,k,q,t,f,n,s,r,F;z=this;u=z.config._$;if(!u){return}D=g.length;if(D===0){u.hide();return}F=Math.ceil(D/5);E=u.find(".fn-arrows").data({index:0,max:F-1});if(F>1){E.show()}h=u.find(".fn-ad-items").detach().empty();for(C=y=0,n=F;0<=n?y<n:y>n;C=0<=n?++y:--y){p=$("<ul>").addClass("show_box");if(z.config.id==="J_alsobuy"){p.attr("request_id",z.config.request_id)}if(C!==0){p.hide()}x=C*5;B=x+5;B=B>D?D:B;for(A=w=s=x,r=B;s<=r?w<r:w>r;A=s<=r?++w:--w){f=g[A]||{};t=f.pid-0;k=cart.getProductImgUrl(0,t,0,"b");q=cart.getProductUrl(t);v="";if(f.addToCart){v="<a href='javascript:;' data-item='"+t+"' class='btn_add fn-add-cart' dd_name='加入购物车'>加入购物车</a>"}if(f.isMonitor){q+="#ddclick_reco_shoppingcart_recobar"}o=$("<li> <a href='"+q+"'  class='gpic' title='"+f.name+"' dd_name='查看商品详情' target='_blank'> <img src='"+k+"' width='150' height='150'> </a> <p><a href='"+q+"' target='_blank' dd_name='查看商品详情'>"+f.name+"</a></p> <p><span class='price'>¥"+(d.priceNormalize(f.price.salePrice))+"</span></p> "+v+" </li>");o.appendTo(p)}h.append(p)}E.on("click","a",function(){var l,i,j,m;l=$(this);m=(l.index()===0?-1:1);i=E.data("index");B=E.data("max");j=i+m;if(j>B){j=0}if(j<0){j=B}h.children().hide().eq(j).show();E.data("index",j);return false});return u.find(".fn-arrows").after(h)};$(".fn-shopping-ads").on("click",".fn-add-cart",function(){var g,h,f,i;h=$(this).data("item");g=$("#J_errorBox");i=$('.fn-add-cart[data-item = "'+h+'"]');f=i.data("item");return $.ajax({type:"GET",url:"shopping_cart_add",cache:false,data:{invoke_type:1,product_ids:f},dataType:"json",success:function(j){if(0!==j.code&&i){if(100===j.code||102===j.code||228===j.code){i.html("卖完了")}else{if(501===j.code||502===j.code){g.find("p").html(j.body["msg"]);cart.showTip(i,g,2)}else{i.html(j.body["msg"])}}}else{return cart.show()}},error:function(){return alert(cart.errorMessage.error_100)}})});return e})();d={renderGiftShopTitle:function(e){return"<div class='topic'>"+e+"</div>"},shopSplitBegin:function(){return"<div class='section'>"},shopSplitEnd:function(){return"</div>"},renderGiftMain:function(f,e){return"<div class='topic_gift'><span class='gift_tip'>赠品"+e+"个，可选1个</span>"+f+"</div>"},giftSplitBegin:function(e){if(e>5){return"<div class='roll_list'><a href='javascript:void(0)' class='btn_arr fn-gift-left disable'></a><a href='javascript:void(0)' class='btn_arr right fn-gift-right'></a>"}else{return"<div class='roll_list'><a href='javascript:void(0)' class='btn_arr fn-gift-left disable'></a><a href='javascript:void(0)' class='btn_arr right disable fn-gift-right'></a>"}},giftUlBegin:function(e){if(e){return"<ul class='reduce' style='/* display:none */'>"}else{return"<ul class='reduce' style='display:none'>"}},giftUlEnd:function(){return"</ul>"},giftSplitEnd:function(){return"</div>"},renderGiftInfo:function(f,g,h,e){return"<li id='"+h+"_"+f+"_"+e+"'><a class='pic fn-change-gift' target='_blank'><img src='"+(cart.getProductImgUrl(0,f,0,"m"))+"' width='70' height='70'><span></span></a><p class='introduce'>"+g+"</p></li>"},isFilterCategoryPath:function(e){if(e.indexOf("01.58")===0||e.indexOf("01.59")===0||e.indexOf("01.69")===0||e.indexOf("01.73")===0||e.indexOf("01.41.57")===0){return true}else{return false}},isCanCheck:function(e){var s,v,u,t,r,p,A,y,h,o,g,q,z,f,x,w;s=false;z=e.products;v=e.collections;if(z){h=z.length;for(u=p=0,f=h;0<=f?p<f:p>f;u=0<=f?++p:--p){if(z[u].offline!==true&&z[u].stock!==0){s=true;return s}}}if(v){A=v.length;for(t=o=0,x=A;0<=x?o<x:o>x;t=0<=x?++o:--o){q=v[t].productList;if(q){y=q.length;for(r=g=0,w=y;0<=w?g<w:g>w;r=0<=w?++g:--g){if(q[r].offline!==true&&q[r].stock!==0){s=true;return s}}}}}return s},isMoreBuyMoreDirectPrice:function(e){return e===1},isProductGiftOne:function(e){return e===3},isLimitMaxBuy:function(e){return e===5},isShopFullMoneyGift:function(e){return e===12},isShopFullMoneyDirectPrice:function(e){return e===14},isShopFullMoneyDiscount:function(e){return e===15},isFullMoneyDirectPrice:function(e){return e===20},isFullMoneyDiscount:function(e){return e===23},isProductExchange:function(e){return e===28},isProductGiftMore:function(e){return e===30},isAtLastBuy:function(e){return e===51},isSnapUp:function(e){return e===102},isCollectionFullMoneyGift:function(e){return e===201},isFullCountOneFree:function(e){return e===205},isNFields:function(e){return e===206},isFullCountDiscount:function(e){return e===207},isPackageWithAppotionBenefit:function(e){return e===225},isAreaMarkert:function(e){return e===228},isEBookExchange:function(e){return e===229},isSecondKill:function(e){return e===230},isPureGift:function(e){return d.isProductGiftOne(e)||d.isProductGiftMore(e)},isPureExchange:function(e){return d.isProductExchange(e)||d.isEBookExchange(e)},isProdGiftPromo:function(e){return d.isPureGift(e)||d.isPureExchange(e)},isSnapUpOrAreaMarket:function(e){return d.isSnapUp(e)||d.isAreaMarkert(e)},giftShow:function(f){var e;e=true;if(this.isEBookExchange(f.promotionType)&&(f!=null)&&(f.giftList!=null)&&f.giftList.length>0){e=f.giftList[0].selected}return e},isEbook:function(e){return e.productId>1900000000&&e.productId<2000000000},numberCanNotBeChanged:function(e){return d.isEbook(e)||e.stock<=0||e.offline},isNeedShowMobilePrice:function(f){var e;e=true;if(f.mobileExclusivePrice<=0){return false}else{if(f.vipPrice>0&&f.vipPrice<=f.mobileExclusivePrice){return false}else{if(f.salePrice>0&&f.salePrice<=f.mobileExclusivePrice){return false}else{if(f.promoPrice>0&&f.promoPrice<=f.mobileExclusivePrice){return false}}}}return e},GiftLabel:function(g,f,e,i,h){return{promotionLabel:g,promotionColor:f,treeIconColor:e,tableColor:i,colorOnImage:h}},productGiftOne:function(){return new this.GiftLabel("赠品","ebtn egreen","tree_icon egreen","choosen green","icon green")},productGiftMore:function(){return new this.GiftLabel("赠品","ebtn egreen","tree_icon egreen","choosen green","icon green")},productExchange:function(){return new this.GiftLabel("加价购","ebtn eblue","tree_icon eblue","choosen blue","icon blue")},eBookExchange:function(){return new this.GiftLabel("电子书加价购","ebtn eyellow","tree_icon eyellow","choosen yellow","icon yellow")},collectionFullMoneyGift:function(){return new this.GiftLabel("满额赠","ebtn egreen","tree_icon egreen","choosen green","icon green")},getAdaptiveLabelObject:function(e){switch(e){case 3:return this.productGiftOne();case 30:return this.productGiftMore();case 28:return this.productExchange();case 229:return this.eBookExchange();case 201:return this.collectionFullMoneyGift()}},getVipTipByLevel:function(e){switch(e){case 1:return"金卡VIP价";case 2:return"钻石VIP价";case 3:return"银卡VIP价"}},getVipLevel:function(e){switch(e){case 1:return"金卡VIP";case 2:return"钻石VIP";case 3:return"银卡VIP"}},havAreaMarketPrice:function(m){var j,h,f,e,g,n,k;j=false;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(h=f=0,k=e;0<=k?f<k:f>k;h=0<=k?++f:--f){g=n[h];if(d.isAreaMarkert(g.promotionType)){j=true;break}}}}return j},haveSnapUp:function(m){var g,j,f,e,h,n,k;g=false;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(j=f=0,k=e;0<=k?f<k:f>k;j=0<=k?++f:--f){h=n[j];if(d.isSnapUp(h.promotionType)){g=true;break}}}}return g},getSnapUpReduce:function(m){var j,f,e,h,n,k,g;g=0;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(j=f=0,k=e;0<=k?f<k:f>k;j=0<=k?++f:--f){h=n[j];if(d.isSnapUpOrAreaMarket(h.promotionType)){g=h.disPrice;break}}}}return g},getVOrNewOrZ:function(f){var e;e="";if(f!=null){switch(f.productType){case 88:e="<span class='red'>尾品特价</span>";break;case 89:e="<span class='red'>新品特价</span>";break;case 90:e="<span class='red'>最值当价</span>"}}return e},removeDot:function(e){return(""+e).replace(/.00/g,"")},discountNormalize:function(e){return parseFloat(e/10).toFixed(1)},priceNormalize:function(e){return parseFloat(e).toFixed(2)},eBookIsSelect:function(e){var f,g;f=false;if(e.promotionType===229){if(((g=e.giftList)!=null?g.length:void 0)>0){f=e.giftList[0].selected}}return f},hasBbNone:function(k){var j,m,g,f,e,h;g=false;j=k.promotionList;if((j!=null?j.length:void 0)>0){for(f=e=0,h=j.length;0<=h?e<h:e>h;f=0<=h?++e:--e){m=j[f];if(d.isPureGift(m.promotionType)||d.isProductExchange(m.promotionType)||(d.isEBookExchange(m.promotionType)&&d.eBookIsSelect(m))){g=true;break}}}return g},showProductName:function(e,u){var k,v,t,s,o,j,q,h,g,f,r,p;if(u===void 0||u==="product"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=102){q=e.length;for(o=j=50,f=q;50<=f?j<f:j>f;o=50<=f?++j:--j){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=102){return e.substr(0,o)+"..."}}}return e}catch(v){k=v;return e}}else{if(u==="gift"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=42){q=e.length;for(o=h=21,r=q;21<=r?h<r:h>r;o=21<=r?++h:--h){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=42){return e.substr(0,o)+"..."}}}return e}catch(t){k=t;return e}}else{if(u="gift_selected"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=64){q=e.length;for(o=g=32,p=q;32<=p?g<p:g>p;o=32<=p?++g:--g){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=64){return e.substr(0,o)+"..."}}}return e}catch(s){k=s;return e}}}}},nameIsLong:function(f){var g,e;try{return f.replace(/[^\x00-\xff]/g,"**").length>=102}catch(e){g=e;return false}},prodNumOfOnePackage:function(g,h){var f,e;try{if((h!=null)&&h.promotionType===225){return parseFloat(g/h.collectionNum).toFixed(0)}else{return g}}catch(e){f=e;return g}}};c=(function(){function e(f){this.info=f;this.allProductIds=[];this.ddVipType=0;this.maxIndex=999;this.imageDomain="http://img3x";this.DDDomain=".ddimg.cn/";this.imgN="-1_";this.imgSuffix=".jpg";this.MIN_C2C_PRODUCT_ID=1500000000;this.errorMessage={error_100:"网络连接超时!",error_202:"移入收藏失败",error_203:"删除失败",error_207:"很抱歉，二手书暂不支持收藏。"};this.html_temps={mask:function(){},div_gift:function(r,y){var O,B,p,G,z,E,g,o,s,C,K,L,I,F,M,N,D,J,A,t,h,H,q,x,v,u,k,w,P;if(y==null){y={}}try{H=r.promotionType;C=r.giftList;M=C.length;P=Math.ceil(M/6);if(P>3){P=3}w=t="";k=[];t="<div class='pages fn-pages'>";for(L=F=0,q=P;0<=q?F<q:F>q;L=0<=q?++F:--F){if(L!==0){K="display:none"}w+="<ul class='clearfix' style='"+K+"'>";J=L*6+6;if(J>M){J=M}for(I=D=x=L*6,v=J;x<=v?D<v:D>v;I=x<=v?++D:--D){E=C[I];if(d.isCollectionFullMoneyGift(H)){E.collFullGiftTips="";if(r.step<E.step){E.collFullGiftTips="<div class='un_mask'></div><div class='un_tip'>满"+E.buyTotalMoneyCanBeSelect+"元可选该赠品</div>";E.unable="unable"}}z=E.giftId-0;w+="<li class='fn-choose-gift "+(E.unable||"")+"' data-item='"+E.giftId+"_"+y.itemId+"_"+r.promotionId+"'> <a href='"+(cart.getProductUrl(E.giftId))+"' class='img' target='_blank'><img src='"+(cart.getProductImgUrl(0,E.giftId,0,"m"))+"' width='70' height='70'></a> <div class='info fn-select-gift'><p class='name' title='"+E.giftName+"' style='word-break:break-all;  word-wrap:break-word;'>"+(d.showProductName(E.giftName,"gift"))+"</p> <p><span class='red'>¥"+(d.isPureExchange(H)?d.priceNormalize(E.exchangePrice):"0.00")+"</span><span class='through'>¥"+(d.priceNormalize(E.salePrice))+"</span></p> "+(E.collFullGiftTips||"")+"</div> </li>";if(E.selected||d.isProductGiftMore(H)){k.push(E)}}t+="<a href='javascript:;' class='"+(L===0?"on":void 0)+"'>"+(L+1)+"</a>";w+="</ul>"}t+="</div>";H=r.promotionType;if(d.isProdGiftPromo(H)){h="购买此商品,可享促销&nbsp;&nbsp;"}else{if(d.isCollectionFullMoneyGift(H)){h="购买<a href='"+(cart.getSpecialPromotionUrl(r.promotionId))+"' class='more' target='_blank'>指定商品</a>，可享促销&nbsp;&nbsp;"}}N="<p class='event'>"+h+"<a href='javascript:;' class='"+(d.getAdaptiveLabelObject(H).promotionColor)+" fn-toggle-gift'>"+(d.getAdaptiveLabelObject(H).promotionLabel)+"</a></p> <div class='event_list' style='display:none'> "+w+" "+t+" </div>";if(k.length>0){N="";for(s=A=0,u=k.length;0<=u?A<u:A>u;s=0<=u?++A:--A){O=k[s];B="";if(d.isPureGift(H)){if(O.count>0&&y.prodCount>O.count){B="<span class='red'>库存不够"+y.prodCount+"件</span>"}else{if(O.count<=0){B="<span class='red'>缺货</span>"}}}if(d.isPureExchange(H)){g="<span class='red'>¥"+(d.priceNormalize(O.exchangePrice))+"</span><span class='through'>¥"+(d.priceNormalize(O.salePrice))+"</span>";o="<span class='red'>¥"+(d.priceNormalize(O.exchangePrice))+"</span>"}else{g="<span class='through'>¥"+(d.priceNormalize(O.salePrice))+"</span></span>";o="<span class='red'>¥0.00</span>"}N+="<table width='100%' border='0' cellspacing='0' cellpadding='0' class='"+(d.getAdaptiveLabelObject(H).tableColor)+"'> <tbody> <tr> <td class='row_name'> <a target='_blank' href='"+(cart.getProductUrl(O.giftId))+"' class='goods'><img src='"+(cart.getProductImgUrl(0,O.giftId,0,"m"))+"' width='70' height='70'><span class='"+(d.getAdaptiveLabelObject(H).colorOnImage)+"'>"+(d.getAdaptiveLabelObject(H).promotionLabel)+"</span></a> <a href='"+(cart.getProductUrl(O.giftId))+"' class='name' target='_blank' title='"+O.giftName+"' style='word-break:break-all;  word-wrap:break-word;'>"+(d.showProductName(O.giftName,"gift_selected"))+"</a> </td> <td class='row3'>"+g+"</td> <td class='fn-count-tip row3'><span class='amount amount_e'>"+O.count+"</span>"+(B||"")+"</td> <td class='row4'>"+o+"</td> <td class='row5'><span>"+(H!==30?"<a href='javascript:;' class='fn-remove-gift' dd_name='删除赠品' data-item='"+O.itemGiftid+"'>删除</a>":"")+"</span></td> </tr> </tbody> </table>"}}if(y.from==="collection"){if(d.isCollectionFullMoneyGift(H)){y.treeClass="tree_last"}else{y.treeClass="tree"}}else{if(y.isLast){y.treeClass="tree_last"}else{y.treeClass="tree"}}if(y.from==="single"){if(!y.isLast){y.hsaBbNone2="bb_none2"}}else{if(y.from==="collection"){if(y.isLastOfCollection){y.hsaBbNone2="bb_none2"}}}if(k.length>0){y.choosenTrClass="choosen_tr"}return"<tr class='"+(y.hsaBbNone2||"")+" "+(y.treeClass||"")+" "+(y.choosenTrClass||"")+"'> <td class='row1'></td> <td class='row_img'><span class='"+(d.getAdaptiveLabelObject(H).treeIconColor)+"'>&nbsp;</span></td> <td class='event_box' colspan='5'> "+N+" </td> </tr>"}catch(G){p=G}},ul_promotions:function(r,o){var n,k,j,m,p,g,h,q;if(r==null){r=[]}if(o==null){o={}}p=r.length;if(p>0){for(n=j=h=p-1;h<=0?j<=0:j>=0;n=h<=0?++j:--j){q=r[n].promotionType;if(d.isProdGiftPromo(q)&&d.giftShow(r[n])){m=n;break}}k=false}return((function(){var i,s,l,t;t=[];for(n=i=0,s=p;0<=s?i<s:i>s;n=0<=s?++i:--i){if(n===m){k=true}g=r[n];if(d.giftShow(g)){if(((l=g.giftList)!=null?l.length:void 0)>0){t.push(this.div_gift(g,{isLast:k,itemId:o.itemId,from:o.from,isLastOfCollection:o.isLastOfCollection,prodCount:o.itemCount}))}else{continue}}else{continue}}return t}).call(this)).join("")},ul_promotions_for_collgift:function(i,h){var g;if(h==null){h={}}g=i.giftList;if(g.length>0){g.sort(function(l,k){var j;j=i.step;if(l.step<=j&&k.step<=j){return k.step-l.step}else{if(l.step>j&&k.step<=j){return 1}else{if(l.step<=j&&k.step>j){return -1}else{return l.step-k.step}}}})}return this.div_gift(i,{isLast:true,itemId:0,from:"collection"})},subProduct:function(r,n){var m,j,h,g,o,k,q,p;if(r==null){r=[]}if(n==null){n={}}o="";if(r&&r.length>0){p="<tr class='fn-virtual-product-detail' style='display:none'> <td class='row1'></td> <td class='row_img'></td> <td class='event_box' colspan='5'> <table width='100%' border='0' cellspacing='0' cellpadding='0' class='set_list'>";q="";for(m=j=0,h=r.length;0<=h?j<h:j>h;m=0<=h?++j:--j){g=r[m];q+="<tr> <td class='row_name'> <a target='_blank' href='"+(cart.getProductUrl(g.productId))+"' class='goods'><img src='"+(cart.getProductImgUrl(g.mainProductId,g.productId,g.numImages,"m"))+"' width='80' height='80' /></a> <a href='"+(cart.getProductUrl(g.productId))+"' class='name' title='"+g.productName+"' style='word-break:break-all;  word-wrap:break-word;' target='_blank'>"+g.productName+"</a> </td> <td class='row3'><span class='through'>&yen;"+(d.priceNormalize(g.salePrice))+"</span></td> <td class='fn-count-tip row3'><span class='amount amount_e'>"+g.itemCount+"</span></td> <td class='row4'></td> <td class='row5'></td> </tr>"}k="</table> </td> </tr>"}o=p+q+k;return o},table_shop_title:function(j,h){var g,i;if(h==null){h={}}g=function(l){var n,m,k;if(l==null){l={}}if(l.shopBasics){n=l.shopBasics;for(m in n){k=n[m];if((m-0)===l.shopIds[0]){return k}}}};$.extend(true,h,j);h.shop_icon="";h.shopUrl=g(h).shopUrl;if(((i=h.shopUrl)!=null?i.indexOf("http://"):void 0)<0){h.shopUrl="http://"+h.shopUrl}switch(h.showUnitType){case"SELF":h.shopName="<a href='"+h.shopUrl+"' target='_blank'>当当自营</a>";h.shop_icon="<span class='shop_icon'></span>";break;case"EBOOK":h.shopName="<a href='http://e.dangdang.com' target='_blank'>当当电子书</a>";h.shop_icon="<span class='shop_icon store_e'></span>";break;case"MERCHANT":h.shopType=g(h).shopType;h.shopName="<a href='"+h.shopUrl+"' target='_blank'>"+(g(h).shopName)+"</a>";if(h.shopType===6){h.shop_icon="<span class='shop_icon'></span>"}else{h.shop_icon="<span class='shop_icon store_o'></span>"}break;case"OVERSEAS":h.shop_icon="<span class='shop_icon store_h'></span>";h.shopName="<a href='"+h.shopUrl+"' target='_blank'>"+(g(h).shopName)+"</a>";break;case"SELF_MERCHANT_OR_EYES_ENO":h.shop_icon="<span class='shop_icon store_c'></span>";h.shopName=h.collections&&h.collections.length>0?"<a href='"+(cart.getPromotionUrl(h.collections[0].promotionInfo.promotionId))+"' target='_blank'>"+h.collections[0].promotionInfo.promotionName+"</a>":""}h.customerService=h.shopIds[0]!==0?"<a data-item='"+h.shopIds[0]+"' href='javascript:;' class='cse fn-imip'><img src='images/icon_cse.gif'></a>":void 0;if(h.allCheck){h.checked="check_on"}h.shopCanCheck="&nbsp;";if(d.isCanCheck(h)){h.shopCanCheck="<a href='javascript:void(0)' dd_name='选中店铺' class='checknow fn-shop-checkall "+h.checked+"'>选中</a>"}return"<table border='0' cellspacing='0' cellpadding='0' class='shop_title'> <tbody> <tr> <td>"+h.shopCanCheck+"</td> <td>"+h.shop_icon+"</td> <td>"+h.shopName+"</td> <td>"+(h.customerService||"")+"</td> <td></td> </tr> </tbody></table>"},tr_shop_end:function(m,i){var j,l,g,h,k;if(i==null){i={}}$.extend(true,i,m);h="<td colspan='2'>&nbsp;</td>";g="<td colspan=3'>&nbsp;";k=0;if(i.showUnitType!=="SELF_MERCHANT_OR_EYES_ENO"){if((j=i.shopPromoList)!=null?j[0]:void 0){l=i.shopPromoList[0];if(d.isShopFullMoneyGift(l.promotionType)){if(l.step<=0&&l.buyAgain>=0){h="<td colspan='2' class='intro'>购买店铺商品，再买"+(d.priceNormalize(l.buyAgain))+"元，可享赠品：<b class='red'>"+l.firstStepGiftName+"</b></td>"}else{if(l.currentFavor>0){h="<td colspan='2' class='intro'>购买店铺商品，已满"+(d.priceNormalize(l.currentFavor))+"元，赠送：<b class='red'>"+l.currentGiftName+"</b></td>"}}}else{if(d.isShopFullMoneyDirectPrice(l.promotionType)){if(l.step<=0&&l.buyAgain>=0){h="<td colspan='2' class='intro'>购买店铺商品，再买"+(d.priceNormalize(l.buyAgain))+"元，可减<b class='red'>"+(d.priceNormalize(l.firstStepDis))+"</b>元</td>"}else{h="<td colspan='2' class='intro'>购买店铺商品，已满"+(d.priceNormalize(l.currentFavor))+"元，已减<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元</td>"}}else{if(d.isShopFullMoneyDiscount(l.promotionType)){if(l.step<=0&&l.buyAgain>=0){h="<td colspan='2' class='intro'>购买店铺商品，再买"+(d.priceNormalize(l.buyAgain))+"元，可享<b class='red'>"+(d.discountNormalize(l.firstStepDis))+"</b>折</td>"}else{h="<td colspan='2' class='intro'>购买店铺商品，已满"+(d.priceNormalize(l.currentFavor))+"元，享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折</td>"}}}}}}if(i.totalShopBenefit>0){g="<td colspan='3' class='row4'><span class='red big alignright'>&yen;"+(d.priceNormalize(i.totalMoney))+"</span><span class='save alignright'>已减<em>&yen;"+(d.priceNormalize(i.totalShopBenefit))+"</em></span>"}else{g="<td colspan='3' class='row4'><span class='red big ooline alignright'>&yen;"+(d.priceNormalize(i.totalMoney))+"</span>"}if(i.showUnitType==="EBOOK"){g+="<a href='javascript:;' class='btn_red fn-ebook-checkout "+(i.totalMoney>0?"":"unable")+"'>铃铛结算电子书</a>"}g+="</td>";return"<tr class='total'> <td class='row1'>&nbsp;</td> <td class='row_img'>店铺合计</td> "+h+" "+g+" </tr>"},table_product:function(H,I){var G,A,h,R,P,r,p,j,O,N,M,J,C,D,F,Q,L,y,V,U,T,S,x,w,v,u,t,s,q,k,W,E,B,K,z,g;if(I==null){I={}}$.extend(true,I,H);I.show_price_red=false;I.vip_mobile_promo_label="";I.price_reduce_head="<div class='low_price fn-up' style='display:none;'>优惠价格<em></em><div class='low_pop' style='display:none'><ul>";I.price_reduce_foot="</ul></div></div>";I.price_reduce_body="";if(I.priceChange){I.price_reduce_body+="<li>· 比上一次进入购物车价格下降"+(d.removeDot(-d.priceNormalize(I.priceChange)))+"元</li>"}if(d.getSnapUpReduce(I)!==0&&!I.vip&&!I.vip){I.price_reduce_body+="<li>· 限时抢促销优惠"+(d.removeDot(d.priceNormalize(d.getSnapUpReduce(I))))+"元</li>"}if(I.vip||I.shopVip){if(d.haveSnapUp(I)){switch(cart.ddVipType){case 1:I.price_reduce_body+="<li>· 金卡VIP抢购";break;case 2:I.price_reduce_body+="<li>· 钻石VIP抢购";break;case 3:I.price_reduce_body+="<li>· 银卡VIP抢购"}}else{I.price_reduce_body+="<li>· "+(d.getVipLevel(cart.ddVipType))}if(I.vipDiscount){I.price_reduce_body+="享受"+(d.removeDot(d.priceNormalize(I.vipDiscount)))+"折，优惠"+(d.priceNormalize(d.removeDot(d.priceNormalize(I.salePrice)-d.priceNormalize(I.vipPrice))))+"元</li>"}else{I.price_reduce_body+="，优惠"+(d.removeDot(d.priceNormalize(d.priceNormalize(I.salePrice)-d.priceNormalize(I.vipPrice))))+"元</li>"}}if(I.from==="collection"){D=I.collectionPromoInfo;if(d.isFullMoneyDirectPrice(D.promotionType)){I.price_reduce_body+="<li>· 享受满额减优惠";L=I.collectionPromoInfo.stepsInfo;for(P=0,r=L.length;P<r;P++){B=L[P];I.price_reduce_body+="，满"+B.favor+"减"+B.dis}I.price_reduce_body+="</li>"}}if(d.isNeedShowMobilePrice(I)){I.price_reduce_body+="<li>· 手机购买价"+(d.removeDot(d.priceNormalize(I.mobileExclusivePrice)))+"元<li>"}if(I.price_reduce_body){I.price_reduce_body=I.price_reduce_head+I.price_reduce_body+I.price_reduce_foot}if(I.promoPrice>0){I.show_price=I.promoPrice}else{I.show_price=I.salePrice}if(I.vip||I.shopVip){I.show_price=I.vipPrice;if(d.haveSnapUp(I)){I.show_price_red=true;switch(cart.ddVipType){case 1:I.vip_mobile_promo_label+="<span class='red'>金卡VIP抢购价</span>";break;case 2:I.vip_mobile_promo_label+="<span class='red'>钻石VIP抢购价</span>";break;case 3:I.vip_mobile_promo_label+="<span class='red'>银卡VIP抢购价</span>"}}else{I.vip_mobile_promo_label=I.vip?"<span class='red'>"+(d.getVipTipByLevel(cart.ddVipType))+"</span>":"<span class='red'>店铺VIP价</span>"}}else{if(d.haveSnapUp(I)){I.show_price_red=true;I.vip_mobile_promo_label+="<span class='red'>限时抢购价 </span>"}}if(d.havAreaMarketPrice(I)){I.vip_mobile_promo_label+="<span class='red'>区域促销价</span>"}I.vip_mobile_promo_label+=d.getVOrNewOrZ(I);if(d.isNeedShowMobilePrice(I)){I.vip_mobile_promo_label+="<span class='red'>手机购买价更低</span>"}if(I.checked){if(I.ebookGift&&d.isEbook(I)){I.product_money="¥0.00"}else{I.product_money="¥"+d.priceNormalize(I.itemTotalMoney)}}else{I.product_money="¥0.00"}if(I.from==="collection"&&d.isMoreBuyMoreDirectPrice((y=I.collectionPromoInfo)!=null?y.promotionType:void 0)&&I.salePrice>I.promoPrice&&I.promoPrice>0&&!d.isFilterCategoryPath(I.categoryPath)){I.through_sale_price="<span class='through'>¥"+(d.priceNormalize(I.salePrice))+"</span>"}I.ebook_gift_tips=I.ebookGift&&d.isEbook(I)?"<div class='price_tip'><span></span>购物车中重复购买该电子书，结算时只保留一本</div>":"";I.tips="";I.limit_buy_label="";I.minBuyCount="";I.maxBuyCount="";if(I.promotionList&&I.promotionList.length>0){x=I.promotionList;for(O=0,p=x.length;O<p;O++){Q=x[O];if(d.isSnapUpOrAreaMarket(Q.promotionType)&&!d.isFilterCategoryPath(I.categoryPath)){if(I.checked){I.tips=Q.maxLimitBuy<I.itemCount?"<div class='price_tip'><span></span>"+Q.maxLimitBuy+"件以内享受促销价,超出部分按照当当价结算</div>":""}I.through_sale_price="<span class='through'>¥"+(d.priceNormalize(I.salePrice))+"</span>"}if(d.isLimitMaxBuy(Q.promotionType)&&Q.maxLimitBuy<=I.itemCount){I.maxBuyCount=Q.maxLimitBuy;I.limit_buy_label="<span class='most red fn-err-msg'>限购"+Q.maxLimitBuy+"件</span>"}if(d.isSecondKill(Q.promotionType)){I.second_kill_span="<span class='red'>秒杀</span>"}if(d.isAtLastBuy(Q.promotionType)){I.limit_buy_label="<span class='most red fn-err-msg'>"+Q.minBuyCount+"件更优惠</span>";I.minBuyCount=Q.minBuyCount;if(I.itemCount===Q.minBuyCount){I.count_of_promo_51="class='default'"}}}}I.pre_sale=I.preSale?"<span class='booking'>[预售]</span>":void 0;I.clazz=I.stock<=0||I.offline?"none":void 0;if(I.offline||I.stock<=0){if(I.offline&&I.stock<=0){I.offlineTip="<span class='oos'>下架</span>"}else{I.nomore=I.stock<=0?"<span class='oos'>缺货</span>":void 0;I.offlineTip=I.offline?"<span class='oos'>下架</span>":void 0}}if(I.stock>0&&I.stock<I.itemCount){I.stock_tip="<span class='red'>库存紧张</span>"}h="";alert_html="";A={changeCount:I.itemCount};if(I.error.reason&&"changeProductCount"===I.error.reason){A=cart.changeProductCountTips(I.error);h=A.errorMsg;alert_html=A.alertMsg}if(d.numberCanNotBeChanged(I)){I.count="<span class='amount amount_e'>"+I.itemCount+"</span>"}else{if(A.itemId&&A.itemId===I.itemId){I.count="<span class='amount fn-updatecount "+(I.maxBuyCount?"red":"")+"' data-value='"+I.itemCount+"'><a dd_name='减少数量' href='javascript:void(0)' "+(I.count_of_promo_51||"")+">-</a><input data-value='"+I.itemCount+"' value='"+I.itemCount+"' type='text'><a dd_name='增加数量' href='javascript:void(0)'>+</a></span>"+h}else{I.count="<span class='amount fn-updatecount "+(I.maxBuyCount?"red":"")+"' data-value='"+I.itemCount+"'><a dd_name='减少数量' href='javascript:void(0)' "+(I.count_of_promo_51||"")+">-</a><input data-value='"+I.itemCount+"' value='"+I.itemCount+"' type='text'><a dd_name='增加数量' href='javascript:void(0)'>+</a></span>"}}I.firstTd="&nbsp;";if(I.checked){I.firstTd="<a href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-product-check checknow check_on'>选中</a>"}else{I.firstTd="<a href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-product-check checknow'>选中</a>"}if(I.offline||I.stock<=0){I.firstTd="&nbsp;"}I.operate="&nbsp;";if(I.offline){I.operate="<span><a dd_name='删除单个下架品' href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-remove-product'>删除</a></span>"}else{if(!NAMESPACE_CART.EAPIDowngradeable_WISHLIST){I.operate="<span><a href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-add-wish' dd_name='加入收藏按钮'>移入收藏</a></span><span><a href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-remove-product' dd_name='删除普通品'>删除</a></span>"}else{I.operate="<span><a href='javascript:void(0)' data-item='"+I.itemId+"' class='fn-remove-product' dd_name='删除普通品'>删除</a></span>"}}if(I.from==="collection"){F=(w=I.collectionPromoInfo)!=null?w.promotionType:void 0;if(d.isPackageWithAppotionBenefit(F)||d.isNFields(F)){if(I.isFirstOfCollection){if(!NAMESPACE_CART.EAPIDowngradeable_WISHLIST){I.operate="<span><a href='javascript:void(0)' data-item='"+I.allItemIds+"' class='fn-add-wish' dd_name='加入收藏按钮'>移入收藏</a></span><span><a href='javascript:void(0)' data-item='"+I.allItemIds+"' class='fn-remove-product' dd_name='删除套餐'>删除</a></span>"}else{I.operate="<span><a href='javascript:void(0)' data-item='"+I.allItemIds+"' class='fn-remove-product' dd_name='删除套餐'>删除</a></span>"}if(((v=I.collectionPromoInfo)!=null?v.checked:void 0)===true){I.firstTd="<a href='javascript:void(0)' data-item='"+I.allItemIds+"' class='fn-product-check checknow check_on'>选中</a>"}else{I.firstTd="<a href='javascript:void(0)' data-item='"+I.allItemIds+"' class='fn-product-check checknow'>选中</a>"}I.itemId=I.allItemIds}else{I.operate="&nbsp;";I.firstTd="&nbsp;"}}}I.virtual_detail=I.subProduct&&I.subProduct.length>0?"<a dd_name='虚拟品商品明细' href='javascript:;' class='ebtn fn-virtual-bind-show'>商品明细</a>":void 0;if(d.nameIsLong(I.productName)){I.productNameShorter=d.showProductName(I.productName);I.shorter=true}if(I.shorter){I.showName=I.productNameShorter}else{I.showName=I.productName}I.color_size="";if(I.saleAttributes&&I.saleAttributes.length>0){u=I.saleAttributes;for(N=0,j=u.length;N<j;N++){G=u[N];I.color_size+="<em>"+G.attributeName+":"+G.selfAttributeValue+"</em>"}if(!NAMESPACE_CART.EAPIDowngradeable_PRODUCT_API_SKU){I.modifyColorAndSize="<a dd_name='修改分色分码' href='javascript:;' class='btn fn-switchsize' data-item='"+H.itemId+"' data-name='"+H.productName+"' data-pid='"+H.productId+"'>修改</a>"}I.switchSise="<div class='swatchsize'>"+(I.modifyColorAndSize||"")+I.color_size+"</div>";if(A.itemId&&A.itemId===I.itemId&&alert_html!=""){I.tips="<div class='price_tip'><span></span>同一商品的不同色码或规格共限购"+I.spuLimitBuyNum+"件</div>"}}if(I.from==="single"||(I.from==="collection"&&d.isCollectionFullMoneyGift((t=I.collectionPromoInfo)!=null?t.promotionType:void 0))){I.color="class= 'red' "}if(I.from==="collection"){if(d.isNFields((s=I.collectionPromoInfo)!=null?s.promotionType:void 0)){I.packageNumOfProd="<span class='num'>数量："+I.itemCount+"</span>";I.packageStyleCtrl5td=" n_set fn-special";I.packageStyleCtrl7td=" n_set n_setr fn-special";I.count="<span class='amount amount_e'>"+I.itemCount+"</span>"}else{if(d.isPackageWithAppotionBenefit((q=I.collectionPromoInfo)!=null?q.promotionType:void 0)){I.packageNumOfProd="<span class='num'>数量："+(d.prodNumOfOnePackage(I.itemCount,I.collectionPromoInfo))+"</span>";I.packageStyleCtrl5td=" n_set fn-special";I.packageStyleCtrl7td=" n_set n_setr fn-special";if(I.isFirstOfCollection){if(A.itemId&&A.itemId===I.allItemIds){I.count="<span class='amount' data-value='"+I.itemCount+"'><a dd_name='减少套餐数量' href='javascript:void(0)'>-</a><input data-item='"+I.batchId+"' data-value='"+((k=I.collectionPromoInfo)!=null?k.collectionNum:void 0)+"' value='"+((V=I.collectionPromoInfo)!=null?V.collectionNum:void 0)+"' type='text'><a dd_name='增加套餐数量' href='javascript:void(0)'>+</a></span><span>套餐商品仅支持成套购买</span>"+h}else{I.count="<span class='amount' data-value='"+I.itemCount+"'><a dd_name='减少套餐数量' href='javascript:void(0)'>-</a><input data-item='"+I.batchId+"' data-value='"+((U=I.collectionPromoInfo)!=null?U.collectionNum:void 0)+"' value='"+((T=I.collectionPromoInfo)!=null?T.collectionNum:void 0)+"' type='text'><a dd_name='增加套餐数量' href='javascript:void(0)'>+</a></span><span>套餐商品仅支持成套购买</span>"}}else{I.count="&nbsp;"}}}}I.hasPromotion=I.promotionList.length>0;if(I.from==="single"){if(I.promotionList&&I.promotionList.length>0){for(R=M=0,S=I.promotionList.length;0<=S?M<S:M>S;R=0<=S?++M:--M){C=I.promotionList[R];if(d.isPureGift(C.promotionType)||d.isProductExchange(C.promotionType)||(d.isEBookExchange(C.promotionType)&&d.eBookIsSelect(C))){I.headLine="tree_first";break}else{I.headLine=""}}}}if(I.from==="single"){if(d.hasBbNone(H)){I.bbNone="bb_none"}}else{if(I.from==="collection"){if(I.isLastOfCollection||d.hasBbNone(H)){I.bbNone="bb_none"}}}I.trClass=(I.bbNone||"")+" "+(I.headLine||"")+" "+(I.clazz||"");E=d.priceNormalize(I.show_price);J="<span>¥"+E+"</span>";W="";if(I.through_sale_price&&I.mediumScopeId===1&&I.productMedium===0&&I.originalPrice&&!d.isFilterCategoryPath(I.categoryPath)){W=d.removeDot(Math.ceil(E*1000/d.priceNormalize(I.originalPrice))/100);J="<span>¥"+E+"("+W+"折)</span>"}if(I.show_price_red){if(I.through_sale_price&&I.mediumScopeId===1&&I.productMedium===0&&I.originalPrice&&!d.isFilterCategoryPath(I.categoryPath)){J="<span class='red'>¥"+E+"("+W+"折)</span>"}else{J="<span class='red'>¥"+E+"</span>"}}if(I.checked){if(I.limitScope=="SPU"&&I.overSpuLimitBuyNum==1){I.tips="<div class='price_tip'><span></span>同一商品的不同色码或规格共限购"+I.spuLimitBuyNum+"件</div>"}}z="<tr id='tr_"+I.itemId+"' class='"+I.trClass+"'> <td class='row1'> "+I.firstTd+(I.nomore||"")+(I.offlineTip||"")+" </td> <td class='row_img'> <a href='"+(cart.getProductUrl(I.productId))+"' target='_blank' dd_name='查看详情'> <img onmouseout='$(this).parent().next().hide()' onmouseover='$(this).parent().next().show()' src='"+(cart.getProductImgUrl(I.mainProductId,I.productId,I.numImages,"m"))+"' width='80' height='80'> </a> <div style='display: none;' class='img_big'><a href='"+(cart.getProductUrl(I.productId))+"' dd_name='查看详情' target='_blank'><img src='"+(cart.getProductImgUrl(I.mainProductId,I.productId,I.numImages,"b"))+"'></a><span class='arrow'></span></div> </td> <td class='row_name'> <div class='name'> <a href='"+(cart.getProductUrl(I.productId))+"' title='"+I.productName+"' target='_blank' dd_name='查看详情' style='word-break:break-all;  word-wrap:break-word;'>"+(I.pre_sale||"")+I.showName+"</a></div> "+(I.packageNumOfProd||"")+" "+(I.switchSise||"")+" "+(I.tips||"")+" "+(I.ebook_gift_tips||"")+" "+(I.virtual_detail||"")+" </td> <td class='row3'>"+J+(I.price_reduce_body||"")+(I.second_kill_span||"")+"</td> <td data-minbuy='"+(I.minBuyCount?I.minBuyCount:0)+"' class='fn-count-tip row3 "+(I.packageStyleCtrl5td||"")+"'>"+I.count+(I.limit_buy_label||"")+(I.stock_tip||"")+"</td> <td class='row4'><span "+(I.color||"")+">"+(I.product_money||"")+"</span></td> <td class='row5 "+(I.packageStyleCtrl7td||"")+"'>"+I.operate+"</td> </tr>";g="";K="";if(I.hasPromotion){K=this.ul_promotions(I.promotionList,{itemId:I.itemId,from:I.from,isLastOfCollection:I.isLastOfCollection,itemCount:I.itemCount})}if(I.subProduct){g=this.subProduct(I.subProduct)}return z+g+K},extractAllItemIdFromColl:function(h){var k,n,j,g,o,m;n="";o=h.productList;if(o&&o.length>0){o.sort(function(l,i){return parseFloat(l.itemId)-parseFloat(i.itemId)});g=o.length;for(k=j=0,m=g;0<=m?j<m:j>m;k=0<=m?++j:--j){n+=o[k].itemId+","}n=n.substring(0,n.length-1);return n}},table_collection:function(s,o){var m,v,D,h,A,E,x,w,B,t,z,y,p,C,G,l,j,r,k,n,q,H,g,F,u;if(o==null){o={}}try{$.extend(true,o,s);if(o.productList==null){o.productList=[]}C=o.productList.length;w="tree_first";G=(j=s.promotionInfo)!=null?j.promotionType:void 0;u="tree_first";if(d.isFullMoneyDirectPrice(G)||d.isFullMoneyDiscount(G)||d.isFullCountDiscount(G)||d.isCollectionFullMoneyGift(G)){u="tree_line"}m=(function(){var M,P,O,N,K,L,J,I,i,V,U,T,S,R,Q;Q=[];for(B=M=0,V=C;0<=V?M<V:M>V;B=0<=V?++M:--M){w=(function(){switch(B){case 0:return u;default:return"tree_line"}})();y=false;t=false;if(d.isPackageWithAppotionBenefit(G)||d.isNFields(G)){y=true;v=this.extractAllItemIdFromColl(s)}t=(function(){switch(B){case 0:return true;default:return false}})();z=(function(){switch(B){case C-1:return true;default:return false}})();r="";if(d.isFullMoneyDirectPrice(G)&&B===0){q="，";U=s.promotionInfo.stepsInfo||[];for(L=0,P=U.length;L<P;L++){n=U[L];q+="满"+n.favor+"减"+n.dis+"元；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额减</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额减' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isFullMoneyDiscount(G)&&B===0){q="，";T=s.promotionInfo.stepsInfo||[];for(J=0,O=T.length;J<O;J++){n=T[J];q+="满"+n.buy_total_money+"元享"+(d.discountNormalize(n.disCount))+"折；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额折</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额折' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isFullCountDiscount(G)&&B===0){q="，";S=s.promotionInfo.stepsInfo||[];for(I=0,N=S.length;I<N;I++){n=S[I];q+="满"+n.buy_total_num+"件享"+(d.discountNormalize(n.discount2))+"折；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满N件折</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满N件折' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isCollectionFullMoneyGift(G)&&B===0){q="";k="";R=s.promotionInfo.giftList||[];for(i=0,K=R.length;i<K;i++){x=R[i];if(k){if(k===x.step&&x.canBeSelected){q+=x.giftName+";"}else{if(k!==x.step){q+=x.buyTotalMoneyCanBeSelect+"、"}}}else{k=x.step;q+="，购物满"+x.buyTotalMoneyCanBeSelect+"、"}}if(q){q=q.substring(0,q.length-1)+"元送赠品"}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额赠</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额赠' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}r+=this.table_product(o.productList[B],{headLine:w,collectionPromoInfo:s.promotionInfo,from:"collection",isFirstOfCollection:t,isLastOfCollection:z,error:o.error,allItemIds:v});Q.push(r)}return Q}).call(this)}catch(A){h=A}l=s.promotionInfo;try{if(l){if(l.disPrice>0){D="<div class='n_total'><span class='red'>¥"+(d.priceNormalize(l.collectionPrice))+"</span><span class='save'>已减<em>¥"+(d.priceNormalize(l.disPrice))+"</em></span></div>"}else{D="<div class='n_total'><span class='red ooline'>¥"+(d.priceNormalize(l.collectionPrice))+"</span></div>"}if(d.isFullMoneyDirectPrice(l.promotionType)){if(l.currentDis<=0||l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+(d.priceNormalize(l.buyAgain))+"元，享受<span class='ebtn ered'>满"+l.nextFavor+"减"+l.nextDis+"元</span></p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已减<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已减<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元；再买<b class='red'>"+(d.priceNormalize(l.buyAgain))+"</b>元，可享受<span class='ebtn ered'>满"+l.nextFavor+"元减"+l.nextDis+"</span></p> </td>"}}}if(d.isFullMoneyDiscount(l.promotionType)){if(l.currentDis<=0||l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+(d.priceNormalize(l.buyAgain))+"元，享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠；再买<b class='red'>"+(d.priceNormalize(l.buyAgain))+"</b>元可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}}}if(d.isFullCountOneFree(l.promotionType)){if(l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+l.buyAgain+"件，最低价商品<b class='red'>0</b>元</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已满"+l.currentFavor+"件，免除最低价商品<b class='red'>"+(d.priceNormalize(l.disPrice))+"</b>元</p> </td>"}}if(d.isFullCountDiscount(l.promotionType)){if(0>=(l.currentFavor-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+l.buyAgain+"件，可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠；再买<b class='red'>"+l.buyAgain+"</b>件，可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}}}if(d.isMoreBuyMoreDirectPrice(l.promotionType)){if(0===(l.meetBuyTotalNum-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品</a>，再买"+l.bugAgain+"件，享受<b class='red'>"+l.nextFavoreDiscount+"</b>折优惠</p> </td>"}else{if(0===(l.bugAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品</a>，已享受<b class='red'>"+l.favorDiscount+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品，已享受<b class='red'>"+l.favorDiscount+"</b>折优惠；再买<b class='red'>"+l.bugAgain+"</b>件可享受<b class='red'>"+l.nextFavoreDiscount+"</b>折优惠</p> </td>"}}}if(d.isPackageWithAppotionBenefit(l.promotionType)){if(!l.checked){F="<p class='event'>套餐购买更优惠</p>"}else{F="<p class='event'>购买此套餐</a>，已减<b class='red'>"+(d.priceNormalize(l.disPrice))+"</b>元</p>"}H="<td class='event_box' colspan='5'> "+D+" "+F+" </td>"}if(d.isNFields(l.promotionType)){if(!l.checked){g="<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>"+l.buyTotalNum+"件，可享受<b class='red'>"+(d.priceNormalize(l.specialPrice))+"</b>元<b class='red'>"+l.buyTotalNum+"</b>件促销</p>"}else{g="<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已满"+l.buyTotalNum+"件，享受<b class='red'>"+(d.priceNormalize(l.specialPrice))+"</b>元<b class='red'>"+l.buyTotalNum+"</b>件促销</p>"}H="<td class='event_box' colspan='5'> "+D+" "+g+" </td>"}if(d.isCollectionFullMoneyGift(l.promotionType)){p=this.ul_promotions_for_collgift(l)}else{p="<tr class='tree_last n_set_total'> <td class='row1'></td> <td class='row_img'><span class='tree_icon ered'></span></td> "+H+" </td> </tr>"}}}catch(E){h=E}return m.join("")+p}}}e.prototype.transfer=function(M){var I,y,A,s,H,L,K,J,G,f,r,g,u,F,E,D,C,q,h,t,x,w,v,z,B;I=this;if(M.body.globalInfo!==null){this.ddVipType=M.body.globalInfo.ddVipType}try{this.allProductIds=[];B=M.body.shopVos;if((B!=null?B.length:void 0)>0){u=B.length;for(L=G=0,t=u;0<=t?G<t:G>t;L=0<=t?++G:--G){z=B[L];if(z.products&&z.products.length>0){g=z.products.length;for(C=F=0,x=g;0<=x?F<x:F>x;C=0<=x?++F:--F){q=z.products[C];this.allProductIds.push(q.productId)}}if(z.collections&&z.collections.length>0){A=z.collections;f=A.length;for(K=E=0,w=f;0<=w?E<w:E>w;K=0<=w?++E:--E){y=A[K];if(y.productList&&y.productList.length>0){h=y.productList;r=h.length;for(J=D=0,v=r;0<=v?D<v:D>v;J=0<=v?++D:--D){q=h[J];this.allProductIds.push(q.productId);if(!y.creationDate||y.creationDate<q.creationDate){y.creationDate=q.creationDate}}}}}}}}catch(H){s=H}this.info=M.body;(function(){var m,l,k,j,i;try{if(cart.allProductIds.length>0){$.ajax({url:NAMESPACE_CART.alsobuyUrl+cart.allProductIds.join(","),dataType:"jsonp",jsonp:"js_func",success:function(o){var n,N,p;if(o.code!==0){return false}n=((N=o.data)!=null?N.items:void 0)||[];if(n.length<5){return false}return new a({uid:"买了又买",title:"买过同样商品的用户还买了",id:"J_alsobuy",request_id:(p=o.data)!=null?p.request_id:void 0,provider:function(T){var S,O,Q,P,R;O=[];for(R=0,P=n.length;R<P;R++){Q=n[R];if(Q.adinfo.ad_id!==0){S={};S.product_id=Q.product_id;S.ad_id=Q.ad_id;S.ad_user=Q.adinfo.uid;S.cost=Q.adinfo.cost;O.push(S)}}if(O.length>0){return $.ajax({type:"POST",url:"ad_encrypt",dataType:"json",async:false,data:{adinfo:JSON.stringify(O),rdm:window.DDAD_RDM},success:function(V){var U,W,X;if(V!==null){for(X=0,U=n.length;X<U;X++){W=n[X];if(W.adinfo.ad_id!==0){if(V[""+W.product_id]!==""){W.product_url=V[""+W.product_id]}}}}return T.render((function(){var Y,aa,Z;aa=[];for(Z=0,Y=n.length;Z<Y;Z++){Q=n[Z];aa.push({name:Q.product_name,price:{salePrice:parseFloat(Q.sale_price)/100},pid:Q.product_id,addToCart:false,isMonitor:true})}return aa})())}})}else{return T.render((function(){var U,W,V;W=[];for(V=0,U=n.length;V<U;V++){Q=n[V];W.push({name:Q.product_name,price:{salePrice:parseFloat(Q.sale_price)/100},pid:Q.product_id,addToCart:false,isMonitor:true})}return W})())}}})}})}}catch(m){s=m}try{if(cart.allProductIds.length===0){j=a.prototype.ignoreList;if((j!=null?j.length:void 0)>0){i=j.indexOf("最近浏览");if(i!==-1){j.pop(i)}}$.ajax({url:"recent_view",dataType:"json",success:function(n){if(n.code!==0){return false}if((n.body==null)||n.body.length===0){return false}return new a({uid:"最近浏览",title:"最近浏览",id:"fn-recent-view",provider:function(p){var o;o=(function(){var N,P,Q,O;Q=n.body.slice(0,n.body.length||[]);O=[];for(P=0,N=Q.length;P<N;P++){q=Q[P];O.push({name:q.name,price:{salePrice:q.price.salePrice},pid:q.id,addToCart:true})}return O})();return p.render(o)}})}})}else{$("#fn-recent-view").html("");$("#fn-recent-view").hide()}}catch(l){s=l}try{if(NAMESPACE_CART.isLogin){return $.ajax({url:"list_wish",dataType:"json",success:function(o){var n;if(o.code!==0){return false}n=o.body||[];if(n.length<5){return false}return new a({uid:"我的收藏",title:"我的收藏",id:"fn-my-wish",provider:function(N){var p;return N.render((function(){var O,Q,P;P=[];for(Q=0,O=n.length;Q<O;Q++){p=n[Q];P.push({pid:p.productId,name:p.productName,price:{salePrice:p.salePrice},addToCart:true})}return P})())}})}})}else{j=a.prototype.ignoreList;if((j!=null?j.length:void 0)>0){i=j.indexOf("我的收藏");if(i!==-1){j.pop(i)}}$("#fn-my-wish").html("");return $("#fn-my-wish").hide()}}catch(k){s=k}})();return true};e.prototype.dialog=function(){};e.prototype.render=function(w,h){var f,g,t,q,k,s,v,u,m,l,n,x,j,i,p,z,y,r,o;if(h==null){h={}}t=this;if(!!w){r=this.transfer(w)}if(!r){return}try{$("#J_cartLoading").hide();if(this.info.globalInfo===null||this.info.globalInfo.cartProductCount===0){f=$(".fn-shops").empty();$("#empty").show();$(".shopping_total").hide();$("#cart").hide();$("#district").hide();$("#payAmount").text("¥0.00");$("#totalFavor").text("¥0.00");$(".shopping_total_left span").text("已选择0件商品")}else{l=t.info.globalInfo;if(l){$("#payAmount").text("¥"+parseFloat(l.payAmount).toFixed(2));$("#totalFavor").text("¥"+parseFloat(l.totalFavor).toFixed(2));$(".shopping_total_left span").html('已选择<font color="red">'+l.productCount+"</font>件商品")}$("#empty").hide();$("#cart").show();$("#district").show();$(".shopping_total").show();if(l.payAmount&&l.payAmount>0){$(".shopping_total .fn-checkout").removeClass("unable")}else{$(".shopping_total .fn-checkout").addClass("unable")}}}catch(s){k=s}(function(A){var J,H,F,O,G,N,M,I,E,C,D,L,B,K;if(A){f=$(".fn-shops").empty();N=$("<div>");E=true;for(C=0,D=A.length;C<D;C++){B=A[C];if(E&&!B.allCheck){E=false}O=$("<div>").addClass("fn-shop");K=t.html_temps.table_shop_title(B);H=$("<div>").addClass("shopping_list");M=$('<table width="100%" border="0" cellspacing="0" cellpadding="0"></table>');F=(function(){var Q,P,S,R;S=B.products||[];R=[];for(P=0,Q=S.length;P<Q;P++){L=S[P];R.push("<tbody data-stock='"+L.stock+"' data-offline='"+L.offline+"' data-productid='"+L.productId+"' data-timestamp='"+(L.creationDateForSpuPormo||L.creationDate||0)+"' data-orderForSpuPormo='"+(L.orderForSpuPormo||0)+"'>"+(t.html_temps.table_product(L,{from:"single",error:h}))+"</tbody>")}return R})();G="<tfoot>"+(t.html_temps.tr_shop_end(B,{}))+"</tfoot>";M.append(F);J=(function(){var Q,P,S,R;S=B.collections||[];R=[];for(P=0,Q=S.length;P<Q;P++){I=S[P];R.push("<tbody data-productid='0' data-timestamp='"+(I.creationDateForSpuPormo||I.creationDate||0)+"' data-orderForSpuPormo='"+(I.orderForSpuPormo||0)+"'>"+(t.html_temps.table_collection(I,{error:h}))+"</tbody>")}return R})();M.append(J);$(M.children("tbody").detach().sort(function(S,R){var Q,V,P,U,T;U=$(S).data("stock");T=$(R).data("stock");Q=$(S).data("offline");V=$(R).data("offline");if(U===0||Q===true){if(T!==0&&V!==true){return 1}}else{if(T===0||V===true){return -1}}P=-($(S).data("timestamp")-$(R).data("timestamp"));if(P===0){P=-($(S).data("orderForSpuPormo")-$(R).data("orderForSpuPormo"));if(P===0){P=-(parseFloat($(S).data("productid"))-parseFloat($(R).data("productid")))}}return P})).appendTo(M);M.find("tbody:last tr:last").addClass("bb_none");M.append(G);N.append(O.append(K,H.append(M)))}f.html(N.children());if(E){$("#cart .fn-checkall").addClass("check_on");$(".shopping_total_left .fn-checkall").addClass("check_on")}else{$("#cart .fn-checkall").removeClass("check_on");$(".shopping_total_left .fn-checkall").removeClass("check_on")}}})(this.info.shopVos);try{m=function(){var A,C,B;if(i<=0){clearInterval(window.timer);return location.reload()}else{--i;B=i%60;C=Math.floor((i%3600)/60);A=Math.floor(i/3600);$("#J_limitedMinute").html(C+"分");$("#J_limitedSecond").html(B+"秒");if(!t.info.trueHaveOutlets){$("#weipinboxarea #weipinhui").hide()}if(!t.info.haveZWorthyBuy){$("#weipinboxarea #zuizhidang").hide()}g.show()}};if(this.info.haveOutlets&&this.info.timePass>0){g=$("#weipinboxarea");p=this.info.timePass-0;i=p-0+3;j=i%60;x=Math.floor(i/60);clearInterval(window.timer);window.timer=setInterval(m,1000)}else{$("#weipinboxarea #weipinhui").hide();$("#weipinboxarea #zuizhidang").hide();$("#weipinboxarea").hide();clearInterval(window.timer)}}catch(v){k=v}try{if(h.ischeckorder){cart.checkOrder()}cart.imipOnlineCheck();y=$(".shopping_total").offset().top;n=$("#hide_div").offset().top;z=$(document).scrollTop();o=$(window).height();q=$(".shopping_total").parent();if((y-0)-(n-0)<=20){if(parseFloat(z)+parseFloat(o)<parseFloat(y)){return q.css("position","fixed")}}else{if(parseFloat(y)>=parseFloat(n)){return q.css("position","static")}}}catch(u){k=u}};e.prototype.mergeLogin=function(){return $.ajax({type:"GET",url:"mergeCart",cache:false,success:function(f){if(0===f.code){return window.location.reload(true)}}})};e.prototype.cartLogin=function(){if(false===NAMESPACE_CART.isLogin){return showMsgBox("","","",cart.mergeLogin,"","","shopping")}};e.prototype.getPromotionUrl=function(f){var g;return g=NAMESPACE_CART.PROMO_BASE_URL+"subject.php?pm_id="+f};e.prototype.getSpecialPromotionUrl=function(f){var g;return g=NAMESPACE_CART.PROMO_BASE_URL+f};e.prototype.getShopUrl=function(f){return"http://shop.dangdang.com/"+f};e.prototype.getProductUrl=function(f){var g;return g=NAMESPACE_CART.PROD_BASE_URL+f+".html"};e.prototype.getProductImgUrl=function(g,h,f,i){j;var j;g=g-0;h=h-0;f=f-0;if(f===0&&g!==0){return j=cart.imageDomain+g%10+cart.DDDomain+g%99+"/"+g%37+"/"+g+cart.imgN+i+cart.imgSuffix}else{return j=cart.imageDomain+h%10+cart.DDDomain+h%99+"/"+h%37+"/"+h+cart.imgN+i+cart.imgSuffix}};e.prototype.countTimer=void 0;e.prototype.updateCount=function(g){var f;f={newCount:g.newCount,oldCount:g.oldCount,itemId:g.cartItemId,from:g.from,trTarget:g.trTarget,target:g.target,productId:g.productId};clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){var h;h=$.ajax({type:"GET",url:"update_count",cache:false,data:{itemIds:g.cartItemId,count:g.newCount},dataType:"json"});return h.then(function(i){if(i.code===0){}else{f.reason="changeProductCount";if(i.code===121){f.oldCount=i.body["data"]["atLeastBuyNum"];f.errorCode=121}if(i.code===144){f.errorMsg=i.body["msg"];f.errorCode=144}if(i.code===124){if(i.body["data"]["promotionType"]&&i.body["data"]["promotionType"]=="5"){}else{f.oldCount=i.body["data"]["maxBuyNum"];f.errorCode=124}}if(i.code===128){f.oldCount=i.body["data"]["maxBuyNum"];f.productId=i.body["data"]["productId"];f.errorCode=128}if(i.code===143){f.errorMsg=i.body["msg"];f.errorCode=143}if(i.code===100){f.errorMsg=i.body["msg"];f.errorCode=100}}return cart.show(f)},function(i){return alert(cart.errorMessage.error_100)})},200)};e.prototype.checkNum=function(g){var f,i,h;i=0;h=this;if(isNaN(g.newCount)){g.target.val(g.oldCount);g.available=false;return false}f=/^\d+$/;if(!f.test(g.newCount)){g.target.val(g.oldCount);g.available=false;return false}if(g.newCount-0<0){g.target.val(g.oldCount);g.available=false;return false}if(g.newCount<g.minLimitBuy){if(g.oldCount>g.newCount){g.target.val(g.oldCount);g.newCount=g.oldCount;g.available=false;if(!g.changeTipTarget.find(".fn-err-msg")){g.changeTipTarget.append('<span class="fn-err-msg red">未达到购买数量</span>')}return false}else{g.num=g.minLimitBuy;g.newCount=g.minLimitBuy;g.available=true;return true}}if(g.maxLimitBuy>0&&g.newCount>g.maxLimitBuy){if(g.newCount>g.oldCount){g.newCount=g.oldCount;g.target.val(g.oldCount);if(!g.changeTipTarget.find("fn-err-msg")){g.changeTipTarget.append('<span class="fn-err-msg red">超过数量上限</span>')}g.available=false;return false}else{g.target.val(g.maxLimitBuy);g.newCount=g.maxLimitBuy;g.available=true;return true}}g.available=true;return true};e.prototype.changePackageCount=function(f){var g;f.minLimitBuy=0;f.maxLimitBuy=10000;f.changeTipTarget=f.target.parent();cart.checkNum(f);if(f.available){clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){},g=$.ajax({type:"GET",url:"update_package_count",cache:false,data:{batch_id:f.batchId,count:f.newCount},dataType:"json"}),g.then(function(h){var i;if(h.code===0){}else{f.reason="changeProductCount";i=h.body["msg"];f.errorCode=h.code;if(h.code===433){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===124){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===128){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===121){f.oldCount=h.body["data"]["atLeastBuyNum"]}}}}}return cart.show(f)},function(h){return alert(cart.errorMessage.error_100)},200))}else{return f.target.val(f.oldCount)}};e.prototype.commit=function(f,g){var i,h;i=this;if(this.commition){if(typeof(h=this.commition).reject==="function"){h.reject()}}this.commition=$.ajax({url:f,cache:false,dataType:"json"});this.commition.always(function(){return i.commition=void 0}).then(function(j){i.render(j,g)},function(j){});return this.commition};e.prototype.show=function(f){this.commit("show",f)};e.prototype.checkProductType=function(f){f=f-0;if(f<this.MIN_C2C_PRODUCT_ID){return 0}if(f>=1900000000&&f<=2000000000){return 2}if(f>=1500000000&&f<=1800000000){return 1}else{return 0}};e.prototype.uncheck_item=function(f){var g;g=$.ajax({type:"GET",url:"uncheck_item",cache:false,data:{item_id:f},dataType:"json"});return g.then(function(h){if(h.code===0){return cart.show()}else{return alert(cart.errorMessage.error_100)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.check_item=function(f){var g;g=$.ajax({type:"GET",url:"check_item",cache:false,data:{item_id:f},dataType:"json"});return g.then(function(h){if(h.code===0){return cart.show()}else{return alert(cart.errorMessage.error_100)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.uncheck_all=function(){var f;f=$.ajax({type:"GET",url:"uncheck_all",cache:false,dataType:"json"});return f.then(function(g){if(g.code===0){return cart.show()}else{return alert(cart.errorMessage.error_100)}},function(g){return alert(cart.errorMessage.error_100)})};e.prototype.check_all=function(){var f;f=$.ajax({type:"GET",url:"check_all",cache:false,dataType:"json"});return f.then(function(g){if(g.code===0){return cart.show()}else{return alert(cart.errorMessage.error_100)}},function(g){return alert(cart.errorMessage.error_100)})};e.prototype.showImip=function(f){var h,g;h={shop_id:f};g={entrance_code:"pc_cart_home",position_code:"main"};return showImDialog(g,h)};e.prototype.imipMergeCart=function(f){return $.ajax({type:"GET",url:"mergeCart",cache:false,success:function(g){if(0===g.code){$("#LoginFalse").hide();NAMESPACE_CART.isLogin=true;$("#LoginFalse").css("display","none");cart.show();return cart.showImip(f)}}})};e.prototype.imipOnlineCheck=function(){var f;f=$(".fn-imip");return $.each(f,function(i,h){var k,g,j;j=$(h).data("item");k={entrance_code:"pc_cart_home",shop_id:j,fields:"is_valid"};g={shopId:j};return getMerchantGroupInfo(k,function(m,l){return cart.imipStatusChange(m.is_valid,l.shopId)},g)})};e.prototype.imipStatusChange=function(f,i){var g,h;g=$(".fn-imip[data-item='"+i+"']");h=g.find("img");if("true"===f||f){return h.attr("src","images/icon_cse.gif")}else{return h.attr("src","images/icon_cse_off.gif")}};e.prototype.showTip=function(k,p,o){var g,q,i,r,l,j,n,f,h,m;g=0;m=0;q=0;r=k.offset();l=r.left;j=r.top;n=k.outerWidth();i=k.outerHeight();h=p.outerWidth();f=p.outerHeight();switch(o){case 1:g=l+n;m=j;q="";break;case 2:g=l-(h-n)/2;m=j-f;q="";break;case 3:g=l-(h-n)/2;m=j+i;q="";break;case 4:g="";m=j-f;q=0;break;default:break}return p.css({left:g,right:q,top:m}).show()};e.prototype.remove_product=function(f){var g;g=$.ajax({type:"GET",url:"remove",cache:false,data:{itemIds:f},dataType:"json"});return g.then(function(h){if(h.code===0){cart.show()}if(h.code===-100){return alert(cart.errorMessage.error_203)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.addToWish=function(f){var g;g=$.ajax({type:"GET",url:"add_wish",cache:false,data:{item_id:f.itemId},dataType:"json"});return g.then(function(h){var i;if(h.code===0){cart.show()}if(h.code===-1||h.code===2){alert(cart.errorMessage.error_202)}if(h.code===3){if(target){i=$("#J_errorBox");i.find("p").html("您已收藏的商品已达到收藏上限，不可以加入收藏了。");return cart.showTip(f.target,i,2)}}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.mergeWish=function(f){var g;g=$.ajax({type:"GET",url:"mergeCart",cache:false});return g.then(function(h){if(h.code===0){$("#LoginFalse").hide();$("#remove_pop").hide();return cart.addToWish(f)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.closeTipBox=function(f){return $(f).parent('[id ^= "J"]').hide()};e.prototype.changeGift=function(f){var h,j,i,g;g="";h="";i=f.target;if("chooseGift"===f.from){g="addGift"}else{g="removeGift"}if("chooseGift"===f.from){h={giftId:f.giftId,cartItemId:f.cartItemId,promtionId:f.promotionId}}else{h={itemGiftId:f.itemGiftId}}j=$.ajax({type:"GET",url:g,cache:false,data:h,dataType:"json"});return j.then(function(k){if(k.code===0){return cart.show()}else{if(k.code===113){i.addClass("unable");return i.append('<div class="un_mask"></div><div class="un_tip">库存紧张</div>')}else{i.addClass("unable");return i.append('<div class="un_mask"></div><div class="un_tip">缺货</div>')}}},function(k){return alert(cart.errorMessage.error_100)})};e.prototype.addGift=function(g,h){var i,f;f="addGift";i=$.ajax({type:"GET",url:f,cache:false,data:g,dataType:"json"});return i.then(function(j){if(j.code===0){h.parent().parent().find("ul li a span").removeClass("choosen");return h.find("a span").addClass("choosen")}else{if(j.code===113){return h.append('<div class="un_mask"></div><div class="un_tip">库存紧张</div>')}else{return h.append('<div class="un_mask"></div><div class="un_tip">缺货</div>')}}},function(j){return alert(cart.errorMessage.error_100)})};e.prototype.changeProductCountTips=function(f){var g,h;g={errorMsg:"",alertMsg:"",changeCount:f.newCount,itemId:f.itemId};if(f){h=f.itemId;if(100===f.errorCode){g.errorMsg='<span class="fn-err-msg red">缺货</span>';g.changeCount=f.oldCount}else{if(143===f.errorCode){g.errorMsg='<span class="fn-err-msg red">库存紧张</span>';g.changeCount=f.oldCount}else{if(121===f.errorCode){g.changeCount=f.oldCount}else{if(124===f.errorCode){g.errorMsg='<span class="fn-err-msg red">限购'+f.oldCount+"件</span>";g.changeCount=f.oldCount}else{if(128===f.errorCode){g.alertMsg="同一商品的不同色码或规格共限购"+f.oldCount+"件";g.errorMsg='<span class="fn-err-msg red">超过限购数量</span>';g.changeCount=f.oldCount}else{if(144===f.errorCode){g.errorMsg='<span class="fn-err-msg red">超出限购数量</span>';g.changeCount=f.oldCount}else{if(433===f.errorCode){g.errorMsg='<span class="fn-err-msg red">该套餐限购'+f.oldCount+"套</span>";g.changeCount=f.oldCount}}}}}}}}return g};e.prototype.checkout=function(){return cart.checkOrder()};e.prototype.unCheckUserCart=function(){var f;f=$.ajax({type:"GET",url:"uncheck_all",cache:false});return f.then(function(g){if(g.code===0){$("#LoginFalse").hide();return cart.mergeAndCheckOrder()}},function(g){return location.reload()})};e.prototype.mergeAndCheckOrder=function(g){var h,f;f="mergeCart";if(g){f="mergeCart?breakSpecialPromo=true"}h=$.ajax({type:"GET",url:f,cache:false});return h.then(function(i){if(i.code===0){return cart.checkOrder()}},function(i){return location.reload()})};e.prototype.myEncode=function(){var g,f;f=window.location.href;g=f.indexOf("#");if(g>0){f=f.substring(0,g)}else{g=f.indexOf("dd_refer=");if(g>0){f=f.substring(0,g-1)}}return encodeURIComponent(f)};e.prototype.loginToWish=function(g){var f;f={itemId:g,target:$(".fn-add-wish")};if(false===NAMESPACE_CART.isLogin){return showMsgBox("wish","","",this.mergeWish,f,this,"shopping")}else{g=$(this).data("item");return cart.addToWish(f)}};e.prototype.loginBatchToWish=function(g){var f;f={itemId:g};if(false===NAMESPACE_CART.isLogin){return showMsgBox("wish","","",this.mergeWish,f,this,"shopping")}else{g=$(this).data("item");$("#remove_pop").hide();return cart.addToWish(f)}};e.prototype.checkOrder=function(){var g,f;f=$(".fn-checkout");g=$.ajax({type:"GET",url:"check_order",cache:false,dataType:"json"});return g.then(function(F){var G,W,C,ao,N,an,am,S,Y,K,z,ak,aq,E,ap,ah,aj,ai,L,ag,O,I,q,al,ae,D,ad,v,u,t,ac,U,ab,aa,Z,J,T,A,y,X,V;N=F.body["url"];if(!F){return false}if(F.code===-2){showMsgBox("","","",cart.unCheckUserCart,"","","shopping")}if(F.code===0){return window.location.href=N+"#dd_refer="+cart.myEncode()}else{$("#spuPromoLimitDiv").hide();if(!NAMESPACE_CART.isLogin){cart.show({ischeckorder:true});NAMESPACE_CART.isLogin=true;$("#LoginFalse").hide();return}if(((T=F.body["prods"])!=null?T.length:void 0)>0){ah;Z=[];ae=0;an=[];X=[];ao=0;C=F.body["prods"];var M=new Array();var r=new Array(),Q=new Array(),af=new Array();for(ad=0,v=C.length;ad<v;ad++){U=C[ad];ak=U.message;I=U.body["cartItemId"];z=U.code;if(!I){I=U.body["cartItemId"]}W=$("#tr_"+I);if(828===z){ak=F.body.prods[0].message;Y=ak.split(";").length;$("#ck_tip").find("p").text("您购物车中重复购买了"+Y+"件电子书（"+ak+"），现只为您保留了一本电子书，其余删除，祝您购物愉快！");$("#ck_link").attr("href",N+"#dd_refer="+cart.myEncode());$("#ck_tip").show();return}try{if(433!==z){ah=W.offset().top;Z[ae]=ah}}catch(K){am=K;console.error(am)}if(100===z){if(W.find(".fn-count-tip .fn-err-msg").length===0){W.find(".fn-count-tip").append('<span class="fn-err-msg red">'+ak+"</span>")}else{W.find(".fn-count-tip .fn-err-msg").text(ak)}}else{if(433===z){q=U.body["cartItemIds"];if((q!=null?q.length:void 0)>0){q.sort(function(h,i){return parseFloat(h)-parseFloat(i)})}al=q.join(",");G=$('[data-item = "'+al+'"]').parent().parent();if(G.find(".fn-count-tip .fn-err-msg").length===0){G.find(".fn-count-tip").append('<span class="fn-err-msg red">'+ak+"</span>");aj=G.offset().top;$(window).scrollTop(aj);return false}}else{if(128===z){var R=new spuErrorInfoRecord(U.body["productId"],U.body["productName"],U.body["mainProductId"],U.body["buyNum"],U.body["cartItemId"],U.body["maxBuyNum"]);M.push(R);var w=false;for(var B=0;B<r.length;B++){if(r[B]==U.body["mainProductId"]){w=true;af[B]=parseInt(af[B])+parseInt(U.body["buyNum"])}}if(w==false){r.push(U.body["mainProductId"]);Q.push(U.body["maxBuyNum"]);af.push(U.body["buyNum"])}}else{if(W.find(".fn-count-tip .fn-err-msg").length===0){W.find(".fn-count-tip").append('<span class="fn-err-msg red">'+ak+"</span>")}else{W.find(".fn-count-tip .fn-err-msg").text(ak)}}}}an[ae]=I;X[ae]=I;ae++}if(0!==Z.length){for(ag=ac=0,A=Z.length;0<=A?ac<A:ac>A;ag=0<=A?++ac:--ac){if(Z[ag]>Z[ag+1]){an[ag]=an[ag+1];an[ag+1]=an[ag]}}ai=an[an.length-1];aj=$("#tr_"+ai).offset().top;$(window).scrollTop(aj);if(M.length>0){var x="";for(var H=0;H<r.length;H++){x+='<div class="tips_row"><span class="icon_tip_s"></span>以下同一商品的不同色码或规格共限购<span class="red"> '+Q[H]+" </span>件，请返回购物车修改数量</div>";x+='<dl class="goods_lists"><dt>';for(var k=0;k<M.length;k++){if(M[k]["mainId"]==r[H]){var P="";$("#tr_"+M[k]["cartItemId"]).find("div[class=swatchsize]").each(function(){$(this).find("em").each(function(){P+=" "+$(this).html()})});x+='<div class="goods"><div class="name">';x+="<p>"+M[k]["productName"]+"</p><p>"+$.trim(P)+"</p></div>";x+='<div class="num">购买数量：'+M[k]["buyNum"]+"</div></div>"}}x+='</dt><dd class="num_l">限购数量<b class="red">'+Q[H]+"</b></dd>";x+="</dl>"}$("#spuPromoLimitDiv").find("div[class=popup_limit]").html(x);$("#spuPromoLimitDiv").show()}}return false}if(F.body["comm"]){$("#J_errorBox").find("p").html("<font style='line-height:14px;'>"+F.body["comm"]+"</font>");cart.showTip(f,$("#J_errorBox"),2);return false}if(F.body["shops"]){S=F.body["shops"];L="";for(D in S){V=S[D];L+=d.renderGiftShopTitle(D)+d.shopSplitBegin();for(ab=0,u=V.length;ab<u;ab++){J=V[ab];L+=d.renderGiftMain(J.body.productName,J.body.giftProducts.length)+d.giftSplitBegin(J.body.giftProducts.length);O=0;y=J.body.giftProducts;for(aa=0,t=y.length;aa<t;aa++){ap=y[aa];O++;E=ap.name;aq=ap.id;if(O===1){L+=d.giftUlBegin(true)}else{if(O%5===1){L+=d.giftUlBegin(false)}}L+=d.renderGiftInfo(aq,E,J.body.cartItemId,J.body.promotionId);if(O%5===0||O===J.body.giftProducts.length){L+=d.giftUlEnd()}}L+=d.giftSplitEnd()}L+=d.shopSplitEnd();$("#giftArea").html(L);$("#gift_checkout").attr("href",N+"#dd_refer="+cart.myEncode())}return $("#giftDiv").show()}}},function(h){return alert(cart.errorMessage.error_100)})};return e})();$(function(){var l,f,o,q,g,h,n,e,p,m,k,i,j;g=$("#cart");n=$("#mask");m=$("#sema");f=$(".shopping_total");p=$("#J_removeProductBox");l=$("#J_addWishBox");h=$("#J_errorBox");q=$("#J_batchRemoveProductBox");o=$("#J_batchAddWishBox");e=$("#J_removeGiftBox");i=void 0;$(window).bind("scroll",function(){clearTimeout(i);return i=setTimeout(function(){var v,u,t,s,r;s=$(".shopping_total").offset().top;u=$("#hide_div").offset().top;t=$(document).scrollTop();r=$(window).height();v=$(".shopping_total").parent();if((s-0)-(u-0)<=20){if(parseFloat(t)+parseFloat(r)<parseFloat(s)){return v.css("position","fixed")}}else{if(parseFloat(s)>=parseFloat(u)){return v.css("position","static")}}},200)});$("#showTip").on("mouseover",".fn-show-tip",function(){var r;r=$(this).data("item");return $(".pop_tip[data-item='"+r+"']").toggle()}).on("click",".fn-wish-tip",function(){var r;r=$(this).data("item");r=r.substr(0,r.length-1);return k.loginBatchToWish(r)}).on("click",".fn-remove-tip",function(){var r;r=$(this).data("item");r=r.substr(0,r.length-1);k.remove_product(r);return $("#remove_pop").hide()}).on("click",".fn-clear-tip",function(){var r;r=$(this).data("item");r=r.substr(0,r.length-1);k.remove_product(r);$("#clear_pop").hide();return $("#fn-clear-a").hide()});$(".shopping_total_left").on("click",".fn-clear-tip",function(){var r;r=$(this).data("item");r=r.substr(0,r.length-1);k.remove_product(r);$("#clear_pop").hide();$("#fn-clear-a").hide();return $(this).css("display","none")});e.on("click",".fn-confirm-removegiftbox",function(){var u,s,r,t;e.hide();t=e.attr("target");s=e.attr("itemGiftId");u=e.attr("from");r={target:t,itemGiftId:s,from:u};return k.changeGift(r)}).on("click",".fn-close-removebox",function(){return k.closeTipBox($(this))});p.on("click",".fn-confirm-removebox",function(){var r;p.hide();r=p.attr("itemId");return k.remove_product(r)}).on("click",".fn-close-removebox",function(){return k.closeTipBox($(this))});h.on("click",".fn-close-removebox",function(){return k.closeTipBox($(this))});q.on("click",".fn-confirm-batchremovebox",function(){var r;q.hide();r=q.attr("itemId");return k.remove_product(r)}).on("click",".fn-close-batchremovebox",function(){return k.closeTipBox($(this))});o.on("click",".fn-confirm-batchaddwish",function(){var r;o.hide();r=o.attr("itemId");return k.loginBatchToWish(r)}).on("click",".fn-close-batchwishbox",function(){return k.closeTipBox($(this))});l.on("click",".fn-confirm-addwish",function(){var r;l.hide();r=l.attr("itemId");return k.loginToWish(r)}).on("click",".fn-close-wishbox",function(){return k.closeTipBox($(this))});h.on("click",".fn-confirm-errorbox",function(){return k.closeTipBox($(this))});$("#weipinboxarea").on("mouseover",".fn-vnewz-tips",function(){var r;r=$("#J_vnewzTipBox");return k.showTip($(this),r,2)}).on("mouseout",".fn-vnewz-tips",function(){var r;r=$("#J_vnewzTipBox");return r.hide()});f.on("click",".fn-checkall",function(){var r,s;s=$(this);r=s.hasClass("check_on");if(r){s.removeClass("check_on");$("#cart .fn-checkall").removeClass("check_on");return k.uncheck_all()}else{s.addClass("check_on");$("#cart .fn-checkall").addClass("check_on");return k.check_all()}}).on("click",".fn-batch-remove",function(){var r;r=$(".fn-product-check.check_on").map(function(){return $(this).data("item")}).toArray().join(",");q.attr({itemId:r});return q.show()}).on("click",".fn-batch-wish",function(){var r;r=$(".fn-product-check.check_on").map(function(){return $(this).data("item")}).toArray().join(",");o.attr({itemId:r});return o.show()}).on("click",".fn-checkout",function(){if($(this).hasClass("unable")){return false}return k.checkout()});g.on("click",".fn-switchsize",function(){j({pid:$(this).data("pid"),name:$(this).data("name"),itemId:$(this).data("item")});return false}).on("click",".fn-ebook-checkout",function(){if(NAMESPACE_CART.isLogin){return window.location.href="http://e.dangdang.com/media/api2.go?action=toEbookOrder"}else{showMsgBox("","","",k.mergeLogin,"","","shopping");return false}}).on("click",".fn-imip",function(){var r;r=$(this).data("item");if($(this).find("img").attr("src")==="images/icon_cse_off.gif"){return}if(NAMESPACE_CART.isLogin){return k.showImip(r)}else{return showMsgBox("","","",k.imipMergeCart,r,"","shopping")}}).on("click",".ebtn",function(){return console.log("打开关闭赠品选择")}).on("click",".fn-remove-gift",function(){e.attr({target:$(this),itemGiftId:$(this).data("item"),from:"removeGift"});return k.showTip($(this),e,2)}).on("click",".ebtn",function(){return console.log("分页按钮123")}).on("click","xxxx",function(){return console.log("赠品点击选中")}).on("click","yyyy",function(){return console.log("赠品点击选中")}).on("click","xxxx",function(){return console.log("赠品点击选中")}).on("click",".fn-remove-product",function(){var r;r=p;r.attr({itemId:$(this).data("item")});return k.showTip($(this),r,2)}).on("click",".fn-add-wish",function(){var r,s;s=$(this).data("item");r=$("#J_addWishBox");r.attr({itemId:s});return k.showTip($(this),r,2)}).on("click",".fn-updatecount>a",function(){var u,y,r,v,B,z,s,t,A,x,C,w;A=$(this);console.log("点击加减号");u=k.info.cartId;v=$(A.parent().find("a")[0]);r=$(A.parent().find("input")[0]);s=r.val()-0;z=r.val()-0;y=$(A.parentsUntil("tbody").find("td a")[0]).data("item");x=A.parent().parent().parent();t=x.find(".fn-count-tip");B="dec";w=t.data("minbuy");C=x.find("td:first a").data("item");if(A.hasClass("default")){return}if(A.text()==="+"){B="inc";z=s+1;v.removeClass("default")}else{if(s>=1){z=s-1;if(z===0){}else{if(z===w){v.addClass("default")}else{v.removeClass("default")}}}}if(z===0){p.attr({itemId:C});k.showTip($(this).parent().parent().parent().find(".fn-remove-product"),p,2)}else{r.val(z);k.updateCount({cartId:u,oldCount:s,newCount:z,cartItemId:y,from:B,trTarget:x,target:t})}$("#ck_tip").hide();return false}).on("click",".fn-special a",function(){var r,v,u,x,w,t,s;v=$(this);r=v.parent().find("input");u=r.parent().parent().parent();s=r.val()-0;t=s;x="dec";if(v.hasClass("default")){return}if(v.text()==="+"){t=s+1;x="inc";v.removeClass("default")}else{if(s>=1){t=s-1;if(t===0){}else{v.removeClass("default")}}}w=u.find("td:first a").data("item");if(t===0){p.attr({itemId:w});k.showTip(u.find(".fn-remove-product"),p,2)}else{v.val(t);k.changePackageCount({batchId:r.data("item"),oldCount:s,newCount:t,target:r,from:x,trTarget:u,itemId:w})}$("#ck_tip").hide();return false}).on("keypress",".fn-special input",function(v){var r,w,u,t,z,C,x,B,A,y,s;w=$(this);s=w.val();t=""+w.data("value");B=v.keyCode||v.which;y=w.data("value")-0;A=s-0;z="update_count";u=w.parent().parent().parent();r=w;C=/^\d+$/;if(B===13){if(!C.test(s)){w.val(1);A=1}w.data("value",s);x=u.find("td:first a").data("item");k.changePackageCount({batchId:r.data("item"),oldCount:y,newCount:A,target:r,from:z,trTarget:u,itemId:x})}else{if(B===8){}else{if(b.call([48,49,50,51,52,53,54,55,56,57],B)<0){return false}}}}).on("blur",".fn-special input",function(v){var r,w,u,t,z,C,x,B,A,y,s;w=$(this);s=w.val();t=""+w.data("value");B=v.keyCode||v.which;y=w.data("value")-0;A=s-0;z="update_count";u=w.parent().parent().parent();r=w;C=/^\d+$/;if(!C.test(s)){w.val(1);A=1}x=u.find("td:first a").data("item");return k.changePackageCount({batchId:r.data("item"),oldCount:y,newCount:A,target:r,from:z,trTarget:u,itemId:x})}).on("keypress",".fn-updatecount>input",function(B){var v,z,r,w,D,A,t,s,C,y,x,F,E,u;C=$(this);u=C.val();F=/^\d+$/;x=""+C.data("value");E=B.keyCode||B.which;v=k.info.cartId;w=$(C.parent().find("a")[0]);r=$(C.parent().find("input")[0]);t=C.data("value")-0;A=u-0;z=$(C.parentsUntil("tbody").find("td a")[0]).data("item");D="update_count";y=C.parent().parent().parent();s=y.find(".fn-count-tip");if(E===13){if(!F.test(u)){r.val(1);A=1}C.data("value",u);k.updateCount({cartId:v,oldCount:t,newCount:A,cartItemId:z,from:D,trTarget:y,target:s})}else{if(E===8){}else{if(b.call([48,49,50,51,52,53,54,55,56,57],E)<0){return false}}}}).on("blur",".fn-updatecount>input",function(A){var v,y,r,w,C,z,t,s,B,x,D,u;B=$(this);u=B.val();v=k.info.cartId;w=$(B.parent().find("a")[0]);r=$(B.parent().find("input")[0]);t=B.data("value")-0;z=u-0;y=$(B.parentsUntil("tbody").find("td a")[0]).data("item");C="update_count";x=B.parent().parent().parent();s=x.find(".fn-count-tip");D=/^\d+$/;if(!D.test(u)){r.val(1);z=1}return k.updateCount({cartId:v,oldCount:t,newCount:z,cartItemId:y,from:C,trTarget:x,target:s})}).on("click",".fn-checkall",function(){var t,v,s,r,u;t=$(this);u=t.data("timer");r=t.data("target");v=function(){return 1};s=t.hasClass("check_on");if(s){t.removeClass("check_on");$(".shopping_total_left .fn-checkall").removeClass("check_on");v=function(){return k.uncheck_all()}}else{t.addClass("check_on");$(".shopping_total_left .fn-checkall").addClass("check_on");v=function(){return k.check_all()}}if(u&&r===!s){clearTimeout(u);t.data({timer:0,target:0})}else{u=setTimeout(function(){t.data({timer:0,target:0});return v()},200);t.data({timer:u,target:s})}}).on("click",".fn-select-gift",function(){var t,s,r;t=$(this).parent();if(t.hasClass("unable")){return}s=t.data("item").split("_");r={target:t,giftId:s[0],cartItemId:s[1],promotionId:s[2],from:"chooseGift"};return k.changeGift(r)}).on("click",".fn-shop-checkall",function(){var s,v,x,r,u,t,w;v=$(this);w=v.data("timer");t=v.data("target");x=function(){return 1};u=v.hasClass("check_on");s=v.parentsUntil(".fn-shop").parent().find("a.fn-product-check,a.fn-shop-checkall");r=s.map(function(){return $(this).data("item")}).toArray().join(",");if(u){s.removeClass("check_on");x=function(){return k.uncheck_item(r)}}else{s.addClass("check_on");x=function(){return k.check_item(r)}}if(w&&t===!u){clearTimeout(w);v.data({timer:0,target:0})}else{w=setTimeout(function(){v.data({timer:0,target:0});return x()},200);v.data({timer:w,target:u})}}).on("click",".fn-product-check",function(){var s,y,A,C,z,t,B,u,w,v,x,r;A=$(this);r=A.data("timer");x=A.data("target");C=function(){return 1};t=A.hasClass("check_on");s=A.parentsUntil(".fn-shop").parent().find("a.fn-shop-checkall");B=A.data("item");if(t){s.removeClass("check_on");A.removeClass("check_on");C=function(){return k.uncheck_item(B)}}else{A.addClass("check_on");C=function(){return k.check_item(B)};z=true;y=A.parentsUntil(".fn-shop").parent().find("a.fn-product-check");for(u=0,w=y.length;u<w;u++){v=y[u];if(!$(v).hasClass("check_on")){z=false;break}}if(z){s.addClass("check_on")}}if(r&&x===!t){clearTimeout(r);A.data({timer:0,target:0})}else{r=setTimeout(function(){A.data({timer:0,target:0});return C()},200);A.data({timer:r,target:t})}}).on("click",".fn-toggle-gift",function(){return $(this).parentsUntil("tr").find(".event_list").toggle()}).on("click",".fn-pages > a",function(){var s,r;s=$(this);r=s.index();s.addClass("on").siblings().removeClass("on");s.parent().parent().children("ul").hide().eq(r).show();return false}).on("click",".fn-virtual-bind-show",function(){$(this).parents("tr").next().toggle();return $(this).parents("tr").toggleClass("bb_none")}).on("click",".fn-up",function(){if($(this).find("em").hasClass("up")){$(this).find("em").removeClass("up");return $(this).find(".low_pop").hide()}else{$(this).find("em").addClass("up");return $(this).find(".low_pop").show()}});m.on("click",".fn-close-ss",function(){n.hide();m.hide().data("info",void 0);return false}).on("click",".fn-semasubmit",function(){var s,r;s=m.find(".fn-color.chosen:not(.disabled)");r=m.find(".fn-size.chosen:not(.disabled)");if(s.size()===0||r.size()===0){return false}else{$.ajax({type:"GET",url:"changeSku",cache:false,data:{newProductId:m.attr("newProductId"),cartItemId:m.attr("itemId")},dataType:"json",success:function(t){var u;if(t.code===0){n.hide();m.hide().data("info",void 0);return k.show()}else{if(t.code===1){n.hide();return m.hide().data("info",void 0)}else{u=$(".fn-errormsg",m).text();if(u.indexOf("、该商品缺货！")===-1){return $(".fn-errormsg",m).text(u+"、该商品缺货！")}}}},error:function(t){n.hide();return m.hide().data("info",void 0)}})}return false}).on("click",".fn-color",function(){var r,B,y,w,A,s,u,t,z,C,x,v;y=$(this);s=m.data("info");y.addClass("chosen").siblings().removeClass("chosen");if(y.hasClass("disabled")){$(".fn-semasubmit").addClass("sorry_i_dont")}else{$(".fn-semasubmit").removeClass("sorry_i_dont")}B=m.find(".fn-size").addClass("disabled");A=y.data("index");C=s.matrix_x[A];for(w=u=0,t=C.length;0<=t?u<t:u>t;w=0<=t?++u:--u){x=C[w];if(x&&x.stock!==0){B.filter(function(){if($(this).data("index")===w){return true}}).removeClass("disabled")}}r=B.filter(".chosen");z;v=C[r.data("index")];if((v!=null?v.stock:void 0)===0){if(v!=null?v.size:void 0){if(v.color){z=v.color+"、"+v.size+" 缺货，请您重新选择"}else{z=v.size+" 缺货，请您重新选择"}}else{z=v.color+" 缺货，请您重新选择"}$(".fn-semasubmit").addClass("sorry_i_dont")}else{if(v){$(".fn-semasubmit").removeClass("sorry_i_dont");m.attr("newProductId",v.productId);m.find(".fn-img").attr("src",k.getProductImgUrl(0,v.productId,0,"b"));if(v!=null?v.size:void 0){if(v.color){z=v.color+"、"+v.size}else{z=v.size}}else{z=v.color}}else{$(".fn-semasubmit").addClass("sorry_i_dont")}}$(".fn-errormsg",m).text(z);return false}).on("click",".fn-size",function(){var y,r,A,s,x,C,u,v,t,B,z,w;A=$(this);u=m.data("info");A.addClass("chosen").siblings().removeClass("chosen");if(A.hasClass("disabled")){$(".fn-semasubmit").addClass("sorry_i_dont")}else{$(".fn-semasubmit").removeClass("sorry_i_dont")}y=m.find(".fn-color").addClass("disabled");C=A.data("index");s=u.matrix_y[C];for(x=v=0,t=s.length;0<=t?v<t:v>t;x=0<=t?++v:--v){z=s[x];if(z&&z.stock!==0){y.filter(function(){if($(this).data("index")===x){return true}}).removeClass("disabled")}}r=y.filter(".chosen");w=s[r.data("index")];B;if((w!=null?w.stock:void 0)===0){if(w!=null?w.color:void 0){if(w.size){B=w.color+"、"+w.size+" 缺货，请您重新选择"}else{B=w.color+" 缺货，请您重新选择"}}else{B=w.size+" 缺货，请您重新选择"}$(".fn-semasubmit").addClass("sorry_i_dont")}else{if(w){$(".fn-semasubmit").removeClass("sorry_i_dont");m.attr("newProductId",w.productId);m.find(".fn-img").attr("src",k.getProductImgUrl(0,w.productId,0,"b"));if(w!=null?w.color:void 0){B=w.color+"、"+w.size}else{B=w.size}}else{$(".fn-semasubmit").addClass("sorry_i_dont")}}$(".fn-errormsg",m).text(B);return false});$("#giftArea").on("click",".fn-gift-left",function(){if($(this).hasClass("disable")){return}return $(this).parent().find("ul").each(function(r){if(!$(this).is(":hidden")){$(this).hide();if(r>0){$(this).prev().show();$(this).parent().find("a:eq(1)").removeClass("disable")}if(r>1){$(this).parent().find("a:first").removeClass("disable")}else{$(this).parent().find("a:first").addClass("disable")}return false}})}).on("click",".fn-gift-right",function(){var r;if($(this).hasClass("disable")){return}r=$(this).parent().find("ul").length;return $(this).parent().find("ul").each(function(s){if(!$(this).is(":hidden")){$(this).hide();if(s<r-1){$(this).next().show();$(this).parent().find("a:first").removeClass("disable")}if(s<r-2){$(this).parent().find("a:eq(1)").removeClass("disable")}else{$(this).parent().find("a:eq(1)").addClass("disable")}return false}})}).on("click",".fn-change-gift",function(){var s,r,t;if($(this).parent().find(".un_tip").length>0){return}r=$(this).parent().attr("id").split("_");s={giftId:r[1],cartItemId:r[0],promtionId:r[2]};t=$(this).parent();return k.addGift(s,t)});$("#giftDiv").on("click",".fn-back-cart",function(){return $("#giftDiv").hide()}).on("click",".close",function(){return $("#giftDiv").hide()});$("#spuPromoLimitDiv").on("click",".btn_red",function(){return $("#spuPromoLimitDiv").hide()}).on("click",".pop_btn",function(){return $("#spuPromoLimitDiv").hide()}).on("click",".close",function(){return $("#spuPromoLimitDiv").hide()});j=function(s){var r;if(s==null){s={}}r=function(D){var A,t,E,x,y,v,w,z,C,u,B,F;v={};v.map={title:s.name,colorname:D.colorName,sizename:D.sizeName,img:k.getProductImgUrl(0,s.pid,0,"b")};v.matrix_x=[];v.matrix_y=[];v.colors=[];v.sizes=[];B;u=D.packages;for(w=0,z=u.length;w<z;w++){C=u[w];if(!v.colors[C.colorIndex]||v.colors[C.colorIndex].selected===false){v.colors[C.colorIndex]={color:C.color,img:C.colorImage,index:C.colorIndex,selected:false};if(s.pid===C.productId){v.colors[C.colorIndex].selected=true;B=C.color}}if(!v.sizes[C.sizeIndex]||v.sizes[C.sizeIndex].selected===false){v.sizes[C.sizeIndex]={size:C.size,index:C.sizeIndex,selected:false};if(s.pid===C.productId){if(B){B+="、"+C.size}else{B=C.size}v.sizes[C.sizeIndex].selected=true}}if(!v.matrix_x[C.colorIndex]){v.matrix_x[C.colorIndex]=[]}if(!v.matrix_x[C.colorIndex][C.sizeIndex]){v.matrix_x[C.colorIndex][C.sizeIndex]=[]}v.matrix_x[C.colorIndex][C.sizeIndex]=C;if(!v.matrix_y[C.sizeIndex]){v.matrix_y[C.sizeIndex]=[]}if(!v.matrix_y[C.sizeIndex][C.colorIndex]){v.matrix_y[C.sizeIndex][C.colorIndex]=[]}v.matrix_y[C.sizeIndex][C.colorIndex]=C;console.log(v.matrix_x,v.matrix_y)}$(".fn-errormsg",m).text(B);A=(function(){var I,G,H,J;H=v.colors;J=[];for(G=0,I=H.length;G<I;G++){y=H[G];if(y){if(y!=null?y.selected:void 0){J.push($("<li class='fn-color chosen' data-index='"+y.index+"'><a href='javascript:;' title='"+y.color+"'><img src='"+y.img+"' alt='"+v.map.colorname+"'></a></li>"))}else{J.push($("<li class='fn-color' data-index='"+y.index+"'><a href='javascript:;' title='"+y.color+"'><img src='"+y.img+"' alt='"+v.map.colorname+"'></a></li>"))}}else{J.push("")}}return J})();E=(function(){var I,G,H,J;H=v.sizes;J=[];for(G=0,I=H.length;G<I;G++){F=H[G];if(F){if(F.selected){if(F.size){J.push($("<li class='fn-size chosen'  data-index='"+F.index+"'><a  href='javascript:;'>"+F.size+"</a></li>"))}else{J.push($("<li class='fn-size chosen'  data-index='"+F.index+"'></li>"))}}else{if(F.size){J.push($("<li class='fn-size'  data-index='"+F.index+"'><a  href='javascript:;'>"+F.size+"</a></li>"))}else{J.push($("<li class='fn-size'  data-index='"+F.index+"'></li>"))}}}else{J.push("")}}return J})();m.detach();m.find(".fn-img").attr("src",v.map.img).end().find(".fn-colors").html(A).end().find(".fn-sizes").html(E).end().find(".fn-data").each(function(){var G;G=$(this).data("set");return $(this).html(v.map[G]||"")}).end().data("info",v);n.after(m).show();x=m.find(".fn-color");if((x!=null?x.length:void 0)>0){t=x.filter(".chosen");t.trigger("click")}return v};return $.ajax({type:"GET",url:"getSkuInfo",cache:false,data:{productId:s.pid||0},dataType:"json",success:function(u){var t;t=u.body;if(u.code===0){m.attr("itemId",s.itemId);r(t);return m.show()}}})};k=new c();window.cart=k;k.show()})}).call(this);var spuErrorInfoRecord=function(b,d,e,a,f,c){this.productId=b;this.productName=d;this.mainId=e;this.buyNum=a;this.cartItemId=f;this.maxBuyNum=c};